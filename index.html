<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Personal AI Assistant</title>
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ¤–</text></svg>"
        />

        <!-- Inter Font -->
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />

        <!-- Font Awesome for icons -->
        <title>Zoho SalesIQ Chat Integration</title>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <!-- MathJax for LaTeX support -->
        <script
            id="MathJax-script"
            async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
        ></script>
        <script>
            window.MathJax = {
                tex: {
                    inlineMath: [["\\(", "\\)"]],
                    displayMath: [["\\[", "\\]"]],
                    processEscapes: true,
                    processEnvironments: true,
                },
                options: {
                    skipHtmlTags: [
                        "script",
                        "noscript",
                        "style",
                        "textarea",
                        "pre",
                    ],
                    ignoreHtmlClass: "tex2jax_ignore",
                    processHtmlClass: "tex2jax_process",
                },
            };
        </script>

        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            :root {
                --primary-color: #6366f1;
                --primary-hover: #4f46e5;
                --secondary-color: #ec4899;
                --accent-color: #06b6d4;
                --success-color: #10b981;
                --warning-color: #f59e0b;
                --error-color: #ef4444;
                --background: linear-gradient(
                    135deg,
                    #f0f4ff 0%,
                    #e0f2fe 50%,
                    #f0f9ff 100%
                );
                --surface: rgba(255, 255, 255, 0.8);
                --surface-elevated: rgba(248, 250, 252, 0.9);
                --surface-hover: rgba(241, 245, 249, 0.95);
                --text-primary: #1e293b;
                --text-secondary: #64748b;
                --text-muted: #94a3b8;
                --border: rgba(226, 232, 240, 0.6);
                --border-light: rgba(241, 245, 249, 0.8);
                --shadow:
                    0 1px 3px 0 rgb(0 0 0 / 0.1),
                    0 1px 2px -1px rgb(0 0 0 / 0.1);
                --shadow-lg:
                    0 10px 15px -3px rgb(0 0 0 / 0.1),
                    0 4px 6px -4px rgb(0 0 0 / 0.1);
                --shadow-xl:
                    0 20px 25px -5px rgb(0 0 0 / 0.1),
                    0 8px 10px -6px rgb(0 0 0 / 0.1);
                --shadow-glow: 0 0 40px rgba(99, 102, 241, 0.15);
                --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                --gradient-primary: linear-gradient(
                    135deg,
                    #6366f1 0%,
                    #8b5cf6 100%
                );
                --gradient-secondary: linear-gradient(
                    135deg,
                    #ec4899 0%,
                    #f97316 100%
                );
                --gradient-rainbow: linear-gradient(
                    135deg,
                    #667eea 0%,
                    #764ba2 25%,
                    #f093fb 50%,
                    #f5576c 75%,
                    #4facfe 100%
                );
                --gradient-aurora: linear-gradient(
                    135deg,
                    #667eea 0%,
                    #764ba2 20%,
                    #f093fb 40%,
                    #f5576c 60%,
                    #4facfe 80%,
                    #00f2fe 100%
                );
                --border-radius: 16px;
                --border-radius-lg: 24px;
                --border-radius-xl: 32px;
                --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                --transition-bounce: all 0.6s
                    cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }
            body {
                font-family:
                    "Inter",
                    -apple-system,
                    BlinkMacSystemFont,
                    sans-serif;
                background: var(--background);
                color: var(--text-primary);
                line-height: 1.6;
                overflow-x: hidden;
                min-height: 100vh;
                position: relative;
            }

            body::before {
                content: "";
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background:
                    radial-gradient(
                        circle at 20% 80%,
                        rgba(99, 102, 241, 0.1) 0%,
                        transparent 50%
                    ),
                    radial-gradient(
                        circle at 80% 20%,
                        rgba(236, 72, 153, 0.1) 0%,
                        transparent 50%
                    ),
                    radial-gradient(
                        circle at 40% 40%,
                        rgba(6, 182, 212, 0.05) 0%,
                        transparent 50%
                    );
                z-index: -1;
                animation: aurora 20s ease-in-out infinite;
            }

            @keyframes aurora {
                0%,
                100% {
                    filter: hue-rotate(0deg) brightness(1);
                    transform: scale(1);
                }
                33% {
                    filter: hue-rotate(60deg) brightness(1.1);
                    transform: scale(1.02);
                }
                66% {
                    filter: hue-rotate(120deg) brightness(0.9);
                    transform: scale(0.98);
                }
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
            } /* Enhanced Header */
            .header {
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.95) 0%,
                    rgba(248, 250, 252, 0.95) 100%
                );
                backdrop-filter: blur(20px);
                border-bottom: 1px solid rgba(99, 102, 241, 0.1);
                padding: 1rem 0;
                position: sticky;
                top: 0;
                z-index: 100;
                transition: all 0.3s ease;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            }

            .header:hover {
                box-shadow: 0 8px 30px rgba(99, 102, 241, 0.1);
            }

            .logo {
                display: flex;
                align-items: center;
                gap: 12px;
                font-weight: 700;
                font-size: 1.25rem;
                color: var(--primary-color);
                text-decoration: none;
                transition: all 0.3s ease;
                position: relative;
            }

            .logo::after {
                content: "";
                position: absolute;
                bottom: -4px;
                left: 0;
                width: 0;
                height: 2px;
                background: linear-gradient(
                    135deg,
                    var(--primary-color) 0%,
                    var(--secondary-color) 100%
                );
                transition: width 0.3s ease;
            }

            .logo:hover::after {
                width: 100%;
            }

            .logo:hover {
                transform: translateY(-2px);
            }

            .logo i {
                font-size: 1.5rem;
                background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
                animation: rotate-glow 4s ease-in-out infinite;
            }

            @keyframes rotate-glow {
                0%,
                100% {
                    transform: rotate(0deg);
                    filter: drop-shadow(0 0 5px rgba(99, 102, 241, 0.3));
                }
                50% {
                    transform: rotate(5deg);
                    filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.4));
                }
            }

            .status-indicator {
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 0.875rem;
                color: var(--text-secondary);
                padding: 0.75rem 1.25rem;
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.8) 0%,
                    rgba(248, 250, 252, 0.8) 100%
                );
                border-radius: 50px;
                border: 1px solid rgba(99, 102, 241, 0.2);
                transition: all 0.3s ease;
                backdrop-filter: blur(10px);
                font-weight: 500;
            }

            .status-indicator:hover {
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 1) 0%,
                    rgba(248, 250, 252, 1) 100%
                );
                border-color: rgba(99, 102, 241, 0.4);
                transform: translateY(-1px);
                box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);
            }

            .status-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: #ef4444;
                animation: pulse 2s infinite;
            }

            .status-dot.online {
                background: #10b981;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            } /* Main Layout */
            .main-layout {
                display: grid;
                grid-template-columns: 320px 1fr;
                gap: 2.5rem;
                padding: 2rem 0;
                min-height: calc(100vh - 120px);
            }

            @media (max-width: 1024px) {
                .main-layout {
                    grid-template-columns: 1fr;
                    gap: 1.5rem;
                }

                .sidebar {
                    order: 2;
                }

                .chat-container {
                    order: 1;
                }
            }

            /* Enhanced Chat Container */
            .chat-container {
                background: linear-gradient(
                    145deg,
                    rgba(255, 255, 255, 0.95) 0%,
                    rgba(248, 250, 252, 0.9) 100%
                );
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: var(--border-radius-xl);
                box-shadow:
                    0 25px 50px rgba(0, 0, 0, 0.1),
                    0 0 0 1px rgba(255, 255, 255, 0.5),
                    inset 0 1px 0 rgba(255, 255, 255, 0.8);
                overflow: hidden;
                display: flex;
                flex-direction: column;
                height: 700px;
                max-height: 80vh;
                position: relative;
                transition: var(--transition);
            }

            .chat-container::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background:
                    radial-gradient(
                        circle at 10% 20%,
                        rgba(99, 102, 241, 0.03) 0%,
                        transparent 50%
                    ),
                    radial-gradient(
                        circle at 90% 80%,
                        rgba(236, 72, 153, 0.03) 0%,
                        transparent 50%
                    );
                pointer-events: none;
                z-index: 0;
            }

            .chat-container:hover {
                box-shadow:
                    0 32px 64px rgba(0, 0, 0, 0.15),
                    0 0 0 1px rgba(255, 255, 255, 0.6),
                    inset 0 1px 0 rgba(255, 255, 255, 0.9);
                transform: translateY(-2px);
            } /* Enhanced Chat Header */
            .chat-header {
                background: linear-gradient(
                    135deg,
                    #6366f1 0%,
                    #8b5cf6 50%,
                    #ec4899 100%
                );
                color: white;
                padding: 2rem 1.5rem;
                text-align: center;
                position: relative;
                overflow: hidden;
            }

            .chat-header::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.08'%3E%3Cpath d='M20 20L0 0h40L20 20z'/%3E%3C/g%3E%3C/svg%3E")
                    repeat;
                animation: slide 30s linear infinite;
            }

            @keyframes slide {
                0% {
                    transform: translate(0, 0);
                }
                100% {
                    transform: translate(-40px, -40px);
                }
            }

            .chat-header h2 {
                font-weight: 700;
                margin-bottom: 0.75rem;
                font-size: 1.5rem;
                position: relative;
                z-index: 1;
                text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
                letter-spacing: -0.02em;
            }

            .chat-header p {
                opacity: 0.95;
                font-size: 0.95rem;
                position: relative;
                z-index: 1;
                font-weight: 400;
                text-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
            } /* Enhanced Chat Messages */
            .chat-messages {
                flex: 1;
                overflow-y: auto;
                padding: 1.5rem;
                background: linear-gradient(
                    to bottom,
                    rgba(255, 255, 255, 0.8) 0%,
                    rgba(248, 250, 252, 0.6) 100%
                );
                position: relative;
                z-index: 1;
                scrollbar-width: none; /* Firefox */
                -ms-overflow-style: none; /* IE and Edge */
            }

            .chat-messages::-webkit-scrollbar {
                display: none; /* Chrome, Safari, Opera */
            }

            .message {
                margin-bottom: 1.5rem;
                animation: slideInMessage 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
            }

            @keyframes slideInMessage {
                from {
                    opacity: 0;
                    transform: translateY(20px) scale(0.95);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .message-content {
                max-width: 80%;
                padding: 1.25rem 1.5rem;
                border-radius: 24px;
                position: relative;
                word-wrap: break-word;
                font-size: 0.95rem;
                line-height: 1.6;
                transition: var(--transition);
                backdrop-filter: blur(10px);
            }
            .message.user {
                display: flex;
                justify-content: flex-end;
            }

            .message.user .message-content {
                background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                color: white;
                border-bottom-right-radius: 8px;
                box-shadow:
                    0 8px 32px rgba(99, 102, 241, 0.4),
                    0 0 0 1px rgba(255, 255, 255, 0.1);
                position: relative;
                overflow: hidden;
            }

            .message.user .message-content::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.1) 0%,
                    transparent 100%
                );
                pointer-events: none;
            }

            .message.user .message-content:hover {
                transform: translateY(-1px);
                box-shadow:
                    0 12px 40px rgba(99, 102, 241, 0.5),
                    0 0 0 1px rgba(255, 255, 255, 0.2);
            }

            .message.assistant {
                display: flex;
                justify-content: flex-start;
            }

            .message.assistant .message-content {
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.95) 0%,
                    rgba(248, 250, 252, 0.9) 100%
                );
                border: 1px solid rgba(226, 232, 240, 0.6);
                border-bottom-left-radius: 8px;
                box-shadow:
                    0 8px 32px rgba(0, 0, 0, 0.08),
                    0 0 0 1px rgba(255, 255, 255, 0.5);
                color: var(--text-primary);
                position: relative;
                overflow: hidden;
            }

            .message.assistant .message-content::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(
                    135deg,
                    rgba(99, 102, 241, 0.02) 0%,
                    transparent 100%
                );
                pointer-events: none;
            }

            .message.assistant .message-content:hover {
                transform: translateY(-1px);
                box-shadow:
                    0 12px 40px rgba(0, 0, 0, 0.12),
                    0 0 0 1px rgba(99, 102, 241, 0.1);
                border-color: rgba(99, 102, 241, 0.2);
            }
            .message-meta {
                font-size: 0.75rem;
                color: var(--text-muted);
                margin-top: 0.75rem;
                text-align: right;
                font-weight: 500;
                opacity: 0;
                transform: translateY(5px);
                transition: all 0.3s ease;
            }

            .message:hover .message-meta {
                opacity: 1;
                transform: translateY(0);
            }

            .message.assistant .message-meta {
                text-align: left;
            } /* Enhanced Chat Input */
            .chat-input-container {
                padding: 2rem 1.5rem;
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.95) 0%,
                    rgba(248, 250, 252, 0.9) 100%
                );
                backdrop-filter: blur(20px);
                border-top: 1px solid rgba(226, 232, 240, 0.6);
                position: relative;
                z-index: 1;
            }

            .chat-input-container::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 1px;
                background: linear-gradient(
                    90deg,
                    transparent 0%,
                    rgba(99, 102, 241, 0.3) 50%,
                    transparent 100%
                );
            }

            .chat-input-wrapper {
                display: flex;
                gap: 1rem;
                align-items: flex-end;
                max-width: 100%;
                position: relative;
            }

            .chat-input {
                flex: 1;
                min-height: 52px;
                max-height: 120px;
                padding: 16px 20px;
                border: 2px solid rgba(226, 232, 240, 0.6);
                border-radius: 26px;
                font-family: inherit;
                font-size: 1rem;
                resize: none;
                outline: none;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                line-height: 1.5;
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.9) 0%,
                    rgba(248, 250, 252, 0.8) 100%
                );
                backdrop-filter: blur(10px);
                box-shadow:
                    0 4px 16px rgba(0, 0, 0, 0.05),
                    inset 0 1px 0 rgba(255, 255, 255, 0.8);
            }

            .chat-input::placeholder {
                color: var(--text-muted);
                font-weight: 400;
            }

            .chat-input:focus {
                border-color: var(--primary-color);
                box-shadow:
                    0 0 0 4px rgba(99, 102, 241, 0.15),
                    0 8px 32px rgba(99, 102, 241, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.9);
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 1) 0%,
                    rgba(248, 250, 252, 0.95) 100%
                );
                transform: translateY(-1px);
            }

            .send-button {
                width: 52px;
                height: 52px;
                border: none;
                border-radius: 50%;
                background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                color: white;
                font-size: 1.2rem;
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
                box-shadow:
                    0 8px 32px rgba(99, 102, 241, 0.4),
                    0 0 0 1px rgba(255, 255, 255, 0.2);
                position: relative;
                overflow: hidden;
            }

            .send-button::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.2) 0%,
                    transparent 100%
                );
                border-radius: 50%;
            }

            .send-button:hover:not(:disabled) {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
                transform: translateY(-2px) scale(1.05);
                box-shadow:
                    0 12px 40px rgba(99, 102, 241, 0.5),
                    0 0 0 1px rgba(255, 255, 255, 0.3);
            }

            .send-button:active:not(:disabled) {
                transform: translateY(0) scale(1.02);
            }

            .send-button:disabled {
                background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
                cursor: not-allowed;
                transform: none;
                box-shadow: 0 4px 16px rgba(148, 163, 184, 0.3);
            } /* Enhanced Loading States */
            .typing-indicator {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 1.25rem 1.5rem;
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.95) 0%,
                    rgba(248, 250, 252, 0.9) 100%
                );
                border: 1px solid rgba(226, 232, 240, 0.6);
                border-radius: 24px;
                border-bottom-left-radius: 8px;
                max-width: 320px;
                margin-bottom: 1.5rem;
                backdrop-filter: blur(10px);
                box-shadow:
                    0 8px 32px rgba(0, 0, 0, 0.08),
                    0 0 0 1px rgba(255, 255, 255, 0.5);
                position: relative;
                overflow: hidden;
            }

            .typing-indicator::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(
                    135deg,
                    rgba(99, 102, 241, 0.02) 0%,
                    transparent 100%
                );
                pointer-events: none;
            }

            .typing-dots {
                display: flex;
                gap: 4px;
            }

            .typing-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                animation: typingDot 1.6s ease-in-out infinite;
                box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
            }

            .typing-dot:nth-child(2) {
                animation-delay: 0.2s;
            }

            .typing-dot:nth-child(3) {
                animation-delay: 0.4s;
            }

            @keyframes typingDot {
                0%,
                60%,
                100% {
                    transform: translateY(0) scale(1);
                    opacity: 0.6;
                }
                30% {
                    transform: translateY(-12px) scale(1.2);
                    opacity: 1;
                }
            }

            .typing-text {
                color: var(--text-secondary);
                font-size: 0.9rem;
                font-weight: 500;
                margin-left: 8px;
                position: relative;
                z-index: 1;
            } /* Enhanced Welcome Message */
            .welcome-message {
                text-align: center;
                padding: 4rem 2rem;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: var(--border-radius-lg);
                margin: 1rem;
                position: relative;
                overflow: hidden;
                box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
            }

            .welcome-message::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.08'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM36 0V4h-2V0h-4v4h4v4h2V4h4V0h-4zM0 34v-4h4v4h4v2H4v4H0v-4H4v-2H0zM0 0h4v4H0V0zm60 0h-4v4h4V0z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")
                    repeat;
                opacity: 0.1;
            }

            .welcome-message::after {
                content: "";
                position: absolute;
                top: -50%;
                left: -50%;
                width: 200%;
                height: 200%;
                background: radial-gradient(
                    circle,
                    rgba(255, 255, 255, 0.1) 0%,
                    transparent 70%
                );
                animation: shimmer 8s ease-in-out infinite;
            }

            @keyframes shimmer {
                0%,
                100% {
                    transform: rotate(0deg);
                }
                50% {
                    transform: rotate(180deg);
                }
            }

            .welcome-content {
                position: relative;
                z-index: 1;
            }

            .ai-avatar {
                font-size: 4.5rem;
                margin-bottom: 1.5rem;
                display: block;
                animation: float 3s ease-in-out infinite;
                filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.2));
            }

            @keyframes float {
                0%,
                100% {
                    transform: translateY(0px) scale(1);
                }
                50% {
                    transform: translateY(-15px) scale(1.05);
                }
            }

            .welcome-message h3 {
                font-weight: 700;
                font-size: 2rem;
                margin-bottom: 1rem;
                color: white;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

            .welcome-message p {
                font-size: 1.125rem;
                margin-bottom: 2rem;
                opacity: 0.95;
                max-width: 500px;
                margin-left: auto;
                margin-right: auto;
                line-height: 1.6;
            }

            .welcome-features {
                display: flex;
                justify-content: center;
                gap: 1rem;
                flex-wrap: wrap;
            }

            .feature-tag {
                background: rgba(255, 255, 255, 0.25);
                padding: 0.75rem 1.25rem;
                border-radius: 50px;
                font-size: 0.875rem;
                font-weight: 600;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.3);
                transition: all 0.3s ease;
                cursor: default;
            }

            .feature-tag:hover {
                background: rgba(255, 255, 255, 0.35);
                transform: translateY(-2px);
                box-shadow: 0 8px 20px rgba(255, 255, 255, 0.2);
            }

            /* Sidebar (for larger screens) */
            @media (min-width: 1024px) {
                .main-layout {
                    grid-template-columns: 300px 1fr;
                }

                .sidebar {
                    background: var(--surface);
                    border-radius: 16px;
                    box-shadow: var(--shadow-lg);
                    padding: 1.5rem;
                    height: fit-content;
                    position: sticky;
                    top: 100px;
                }

                .sidebar h3 {
                    font-weight: 600;
                    margin-bottom: 1rem;
                    color: var(--text-primary);
                }

                .sidebar-section {
                    margin-bottom: 2rem;
                }

                .sidebar-section:last-child {
                    margin-bottom: 0;
                }

                .stat-item {
                    display: flex;
                    justify-content: space-between;
                    padding: 0.5rem 0;
                    border-bottom: 1px solid var(--border);
                }

                .stat-item:last-child {
                    border-bottom: none;
                }

                .stat-label {
                    color: var(--text-secondary);
                    font-size: 0.875rem;
                }

                .stat-value {
                    font-weight: 500;
                    color: var(--primary-color);
                }
            }

            /* Mobile Responsive */
            @media (max-width: 768px) {
                .container {
                    padding: 0 16px;
                }

                .chat-container {
                    border-radius: 12px;
                    height: calc(100vh - 140px);
                }

                .chat-input-wrapper {
                    gap: 0.75rem;
                }

                .message-content {
                    max-width: 90%;
                }

                .main-layout {
                    gap: 1rem;
                    padding: 1rem 0;
                }
            }

            /* Error States */
            .error-message {
                background: #fef2f2;
                border: 1px solid #fecaca;
                color: #dc2626;
                padding: 1rem;
                border-radius: 8px;
                margin: 1rem;
                text-align: center;
            }

            /* Enhanced Action Buttons */
            .action-buttons {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }

            .action-btn {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                padding: 0.75rem 1rem;
                border: none;
                border-radius: var(--border-radius);
                font-weight: 500;
                font-size: 0.875rem;
                cursor: pointer;
                transition: var(--transition);
                width: 100%;
                text-align: left;
            }

            .action-btn:hover {
                transform: translateY(-1px);
                box-shadow: var(--shadow-lg);
            }

            .action-btn.primary {
                background: var(--gradient-primary);
                color: white;
            }

            .action-btn.secondary {
                background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                color: white;
                border: none;
                box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            }

            .action-btn.secondary:hover {
                background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
                box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
                transform: translateY(-2px);
            }

            .action-btn.accent {
                background: var(--gradient-secondary);
                color: white;
            }

            .action-btn.info {
                background: var(--accent-color);
                color: white;
            }

            .action-btn i {
                font-size: 1rem;
            }

            /* Memory Conservation Indicator */
            .memory-indicator {
                background: var(--surface-elevated);
                border: 1px solid var(--border);
                border-radius: var(--border-radius);
                padding: 1rem;
                margin-top: 1rem;
            }

            .memory-bar {
                background: var(--border-light);
                border-radius: 50px;
                height: 6px;
                margin-top: 0.5rem;
                overflow: hidden;
            }

            .memory-fill {
                background: var(--gradient-primary);
                height: 100%;
                border-radius: 50px;
                transition: width 0.3s ease;
            }

            .memory-text {
                font-size: 0.75rem;
                color: var(--text-muted);
                margin-top: 0.5rem;
            } /* Enhanced Micro-interactions and Animations */
            @keyframes pulse-soft {
                0%,
                100% {
                    opacity: 1;
                    transform: scale(1);
                }
                50% {
                    opacity: 0.8;
                    transform: scale(1.02);
                }
            }

            @keyframes bounce-in {
                0% {
                    opacity: 0;
                    transform: scale(0.3) translateY(20px);
                }
                50% {
                    opacity: 1;
                    transform: scale(1.05) translateY(-5px);
                }
                70% {
                    transform: scale(0.98) translateY(2px);
                }
                100% {
                    opacity: 1;
                    transform: scale(1) translateY(0);
                }
            }

            .status-dot.online {
                background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
                animation: pulse-soft 2s infinite;
                box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
            }

            /* Enhanced Action Buttons */
            .action-btn {
                position: relative;
                overflow: hidden;
            }

            .action-btn::before {
                content: "";
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.2),
                    transparent
                );
                transition: left 0.5s ease;
            }

            .action-btn:hover::before {
                left: 100%;
            }

            .action-btn.primary {
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            }

            .action-btn.primary:hover {
                background: linear-gradient(135deg, #059669 0%, #047857 100%);
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
                transform: translateY(-2px);
            }

            .action-btn.accent {
                background: linear-gradient(135deg, #ec4899 0%, #f97316 100%);
                box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
            }

            .action-btn.accent:hover {
                box-shadow: 0 8px 25px rgba(236, 72, 153, 0.4);
            }

            .action-btn.info {
                background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
                box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
            }

            .action-btn.info:hover {
                box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
            }

            /* Zoho Services Styling */
            .sidebar-section h3 i.fa-calendar-alt {
                color: #4f46e5;
            }

            .sidebar-section h3 i.fa-headset {
                color: #059669;
            }

            /* Widget Container Styling */
            .widget-container {
                margin-top: 1rem;
                padding: 1rem;
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.9) 0%,
                    rgba(248, 250, 252, 0.9) 100%
                );
                border-radius: var(--border-radius);
                border: 1px solid rgba(99, 102, 241, 0.2);
                backdrop-filter: blur(10px);
                animation: slideIn 0.3s ease-out;
            }

            .widget-container iframe {
                width: 100%;
                border: none;
                border-radius: 8px;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Enhanced action buttons for Zoho services */
            .action-btn {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                font-weight: 500;
                letter-spacing: 0.025em;
                min-height: 40px;
                padding: 0.75rem 1rem;
                gap: 0.5rem;
                text-align: center;
                justify-content: center;
                border-radius: 8px;
                border: none;
                cursor: pointer;
                position: relative;
                overflow: hidden;
            }

            .action-btn:hover {
                transform: translateY(-2px);
            }

            .action-btn:active {
                transform: translateY(0);
            }

            .action-btn.accent {
                background: linear-gradient(135deg, #ec4899 0%, #f97316 100%);
                box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
            }

            .action-btn.accent:hover {
                background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
                box-shadow: 0 8px 25px rgba(236, 72, 153, 0.4);
                transform: translateY(-2px);
            }

            /* Button spacing */
            .action-buttons {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }

            .action-buttons .action-btn {
                width: 100%;
            }

            /* Enhanced Memory Indicator */
            .memory-indicator {
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.8) 0%,
                    rgba(248, 250, 252, 0.8) 100%
                );
                border: 1px solid rgba(99, 102, 241, 0.2);
                border-radius: var(--border-radius);
                padding: 1.25rem;
                margin-top: 1rem;
                backdrop-filter: blur(10px);
                transition: all 0.3s ease;
            }

            .memory-indicator:hover {
                border-color: rgba(99, 102, 241, 0.4);
                transform: translateY(-1px);
                box-shadow: 0 8px 25px rgba(99, 102, 241, 0.1);
            }

            .memory-bar {
                background: rgba(99, 102, 241, 0.1);
                border-radius: 50px;
                height: 8px;
                margin-top: 0.75rem;
                overflow: hidden;
                position: relative;
            }

            .memory-bar::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.3),
                    transparent
                );
                animation: shimmer-bar 2s infinite;
            }

            @keyframes shimmer-bar {
                0% {
                    transform: translateX(-100%);
                }
                100% {
                    transform: translateX(100%);
                }
            }

            .memory-fill {
                background: linear-gradient(
                    135deg,
                    var(--primary-color) 0%,
                    var(--accent-color) 100%
                );
                height: 100%;
                border-radius: 50px;
                transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                box-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
            }

            /* Loading Animation Enhancement */
            .typing-indicator {
                animation: bounce-in 0.5s ease-out;
            }

            /* Enhanced Stat Items */
            .stat-item {
                padding: 0.75rem 0;
                border-bottom: 1px solid rgba(99, 102, 241, 0.1);
                transition: all 0.3s ease;
            }

            .stat-item:hover {
                background: rgba(99, 102, 241, 0.05);
                padding-left: 0.5rem;
                border-radius: 8px;
                border-bottom-color: transparent;
            }

            .stat-item:last-child {
                border-bottom: none;
            }

            .stat-value {
                font-weight: 600;
                background: linear-gradient(
                    135deg,
                    var(--primary-color) 0%,
                    var(--secondary-color) 100%
                );
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
            } /* Enhanced Sidebar */
            .sidebar {
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.95) 0%,
                    rgba(248, 250, 252, 0.95) 100%
                );
                backdrop-filter: blur(20px);
                border-radius: var(--border-radius-lg);
                padding: 1.5rem;
                box-shadow: var(--shadow-xl);
                height: fit-content;
                position: sticky;
                top: 2rem;
                max-height: calc(100vh - 140px);
                overflow-y: auto;
                border: 1px solid rgba(255, 255, 255, 0.8);
            }

            .sidebar-section {
                margin-bottom: 2.5rem;
                animation: slideInFromLeft 0.6s ease-out;
            }

            .sidebar-section:last-child {
                margin-bottom: 0;
            }

            .sidebar-section h3 {
                color: var(--text-primary);
                font-size: 0.875rem;
                font-weight: 700;
                margin-bottom: 1.25rem;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                position: relative;
                padding-bottom: 0.5rem;
            }

            .sidebar-section h3::after {
                content: "";
                position: absolute;
                bottom: 0;
                left: 0;
                width: 30px;
                height: 2px;
                background: linear-gradient(
                    135deg,
                    var(--primary-color) 0%,
                    var(--secondary-color) 100%
                );
                border-radius: 1px;
            }

            .sidebar-section h3 i {
                background: linear-gradient(
                    135deg,
                    var(--primary-color) 0%,
                    var(--secondary-color) 100%
                );
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
                font-size: 1rem;
            } /* Conversation List Styles - Enhanced */
            .conversation-list {
                max-height: 350px;
                overflow-y: auto;
                margin-bottom: 1rem;
                padding: 0.25rem;
            }

            .conversation-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 1rem;
                margin-bottom: 0.75rem;
                border-radius: 12px;
                background: linear-gradient(
                    135deg,
                    var(--surface-elevated) 0%,
                    rgba(255, 255, 255, 0.8) 100%
                );
                border: 1px solid var(--border);
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
                backdrop-filter: blur(10px);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            }

            .conversation-item::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(
                    135deg,
                    rgba(99, 102, 241, 0.05) 0%,
                    rgba(168, 85, 247, 0.05) 100%
                );
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .conversation-item:hover::before {
                opacity: 1;
            }

            .conversation-item:hover {
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.95) 0%,
                    rgba(248, 250, 252, 0.95) 100%
                );
                transform: translateY(-2px) scale(1.02);
                box-shadow:
                    0 8px 25px rgba(0, 0, 0, 0.1),
                    0 4px 12px rgba(99, 102, 241, 0.15);
                border-color: rgba(99, 102, 241, 0.3);
            }

            .conversation-item.active {
                background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                color: white;
                border-color: transparent;
                box-shadow:
                    0 8px 32px rgba(99, 102, 241, 0.3),
                    0 4px 16px rgba(139, 92, 246, 0.2);
                transform: translateY(-1px);
            }

            .conversation-item.active::before {
                background: linear-gradient(
                    135deg,
                    rgba(255, 255, 255, 0.1) 0%,
                    rgba(255, 255, 255, 0.05) 100%
                );
                opacity: 1;
            }

            .conversation-item.active .conversation-meta {
                color: rgba(255, 255, 255, 0.9);
            }

            .conversation-content {
                flex: 1;
                min-width: 0;
                z-index: 1;
                position: relative;
            }

            .conversation-title {
                font-weight: 600;
                font-size: 0.9rem;
                margin-bottom: 0.4rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                line-height: 1.3;
                letter-spacing: -0.01em;
            }

            .conversation-meta {
                font-size: 0.75rem;
                color: var(--text-muted);
                display: flex;
                align-items: center;
                gap: 0.75rem;
                font-weight: 500;
            }

            .conversation-meta i {
                font-size: 0.7rem;
                opacity: 0.8;
            }

            .conversation-meta span {
                display: flex;
                align-items: center;
                gap: 0.25rem;
            }

            .conversation-actions {
                display: flex;
                gap: 0.25rem;
                opacity: 0;
                transition: all 0.3s ease;
                z-index: 2;
                position: relative;
            }

            .conversation-item:hover .conversation-actions {
                opacity: 1;
                transform: translateX(0);
            }

            .conversation-action-btn {
                background: rgba(255, 255, 255, 0.8);
                border: none;
                color: var(--text-secondary);
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 8px;
                transition: all 0.2s ease;
                font-size: 0.75rem;
                backdrop-filter: blur(10px);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .conversation-action-btn:hover {
                background: rgba(255, 255, 255, 1);
                color: var(--primary-color);
                transform: scale(1.1);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            }

            .conversation-item.active .conversation-action-btn {
                background: rgba(255, 255, 255, 0.2);
                color: rgba(255, 255, 255, 0.9);
            }

            .conversation-item.active .conversation-action-btn:hover {
                background: rgba(255, 255, 255, 0.3);
                color: white;
                transform: scale(1.1);
            }

            .new-conversation-btn {
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.75rem;
                padding: 1rem;
                border: 2px dashed rgba(99, 102, 241, 0.3);
                border-radius: 12px;
                background: linear-gradient(
                    135deg,
                    rgba(99, 102, 241, 0.05) 0%,
                    rgba(168, 85, 247, 0.05) 100%
                );
                color: var(--primary-color);
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                font-weight: 600;
                font-size: 0.875rem;
                position: relative;
                overflow: hidden;
            }

            .new-conversation-btn::before {
                content: "";
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.4),
                    transparent
                );
                transition: left 0.5s ease;
            }

            .new-conversation-btn:hover::before {
                left: 100%;
            }

            .new-conversation-btn:hover {
                border-color: var(--primary-color);
                background: linear-gradient(
                    135deg,
                    rgba(99, 102, 241, 0.1) 0%,
                    rgba(168, 85, 247, 0.1) 100%
                );
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);
            }

            .new-conversation-btn i {
                font-size: 1rem;
                transition: transform 0.3s ease;
            }

            .new-conversation-btn:hover i {
                transform: rotate(90deg);
            } /* Enhanced empty state */
            .empty-conversations {
                text-align: center;
                padding: 2rem 1rem;
                color: var(--text-muted);
                font-size: 0.875rem;
                background: linear-gradient(
                    135deg,
                    rgba(99, 102, 241, 0.05) 0%,
                    rgba(168, 85, 247, 0.05) 100%
                );
                border-radius: 12px;
                border: 1px dashed rgba(99, 102, 241, 0.2);
            }

            .empty-conversations i {
                font-size: 2rem;
                margin-bottom: 0.5rem;
                display: block;
                opacity: 0.5;
            }

            /* Streaming response cursor */
            .typing-cursor {
                display: inline-block;
                background-color: var(--primary-color);
                color: transparent;
                animation: blink 1s infinite;
                margin-left: 2px;
            }

            @keyframes blink {
                0%,
                50% {
                    opacity: 1;
                }
                51%,
                100% {
                    opacity: 0;
                }
            }
        </style>
    </head>
    <body>
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-robot"></i>
                        <span>Personal AI Assistant</span>
                    </div>
                    <div class="status-indicator">
                        <div class="status-dot" id="statusDot"></div>
                        <span id="statusText">Connecting...</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="container">
            <div class="main-layout">
                <!-- Sidebar (hidden on mobile) -->
                <aside class="sidebar">
                    <!-- Conversation List Section -->
                    <div class="sidebar-section">
                        <h3><i class="fas fa-comments"></i> Conversations</h3>
                        <button
                            class="new-conversation-btn"
                            onclick="createNewConversation()"
                        >
                            <i class="fas fa-plus"></i>
                            <span>New Conversation</span>
                        </button>
                        <div class="conversation-list" id="conversationList">
                            <!-- Conversations will be populated here -->
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3><i class="fas fa-chart-line"></i> Statistics</h3>
                        <div class="stat-item">
                            <span class="stat-label">Total Messages</span>
                            <span class="stat-value" id="totalMessages">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Session Messages</span>
                            <span class="stat-value" id="sessionMessages"
                                >0</span
                            >
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">AI Model</span>
                            <span class="stat-value" id="aiModel"
                                >Phi-3 Mini</span
                            >
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Response Time</span>
                            <span class="stat-value" id="responseTime">-</span>
                        </div>
                    </div>
                    <div class="sidebar-section">
                        <h3><i class="fas fa-cog"></i> Actions</h3>
                        <div class="action-buttons">
                            <button
                                class="action-btn primary"
                                onclick="newChatSession()"
                            >
                                <i class="fas fa-plus"></i>
                                <span>New Session</span>
                            </button>
                            <button
                                class="action-btn accent"
                                onclick="clearChatHistory()"
                                title="Clear chat history"
                            >
                                <i class="fas fa-trash-alt"></i>
                                <span>Clear History</span>
                            </button>
                            <button
                                class="action-btn accent"
                                onclick="exportChatHistory()"
                            >
                                <i class="fas fa-download"></i>
                                <span>Export Chat</span>
                            </button>
                            <button
                                class="action-btn info"
                                onclick="showSessionInfo()"
                            >
                                <i class="fas fa-info-circle"></i>
                                <span>Session Info</span>
                            </button>
                        </div>
                    </div>

                    <!-- Zoho Bookings Section -->
                    <div class="sidebar-section">
                        <h3>
                            <i class="fas fa-calendar-alt"></i> Zoho Bookings
                        </h3>
                        <div class="action-buttons">
                            <button
                                class="action-btn primary"
                                onclick="toggleBookingWidget()"
                                title="Schedule an appointment"
                            >
                                <i class="fas fa-calendar-plus"></i>
                                <span>Book Meeting</span>
                            </button>
                            <button
                                class="action-btn info"
                                onclick="showBookingInfo()"
                            >
                                <i class="fas fa-info-circle"></i>
                                About Bookings
                            </button>
                        </div>
                        <div
                            id="bookingWidget"
                            class="widget-container"
                            style="display: none"
                        ></div>
                    </div>

                    <!-- Zoho Assist Section -->
                    <div class="sidebar-section">
                        <h3><i class="fas fa-headset"></i> Zoho Assist</h3>
                        <div class="action-buttons">
                            <button
                                class="action-btn accent"
                                onclick="toggleAssistWidget()"
                            >
                                <i class="fas fa-desktop"></i>
                                Remote Support
                            </button>
                            <button
                                class="action-btn primary"
                                onclick="showAssistInfo()"
                            >
                                <i class="fas fa-question-circle"></i>
                                Get Help
                            </button>
                        </div>
                        <div
                            id="assistWidget"
                            class="widget-container"
                            style="display: none"
                        ></div>
                    </div>

                    <div class="sidebar-section">
                        <h3><i class="fas fa-info-circle"></i> About</h3>
                        <p
                            style="
                                font-size: 0.875rem;
                                color: var(--text-secondary);
                                line-height: 1.5;
                            "
                        >
                            This is your personal AI assistant powered by Phi-3
                            Mini, running locally for complete privacy and
                            control.
                        </p>
                        <!-- Integration Status -->
                        <div
                            class="integration-status"
                            style="margin-top: 1rem"
                        >
                            <div
                                style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    margin-bottom: 0.75rem;
                                "
                            >
                                <span
                                    style="
                                        font-size: 0.875rem;
                                        font-weight: 600;
                                        color: var(--text-primary);
                                    "
                                >
                                    <i
                                        class="fas fa-plug"
                                        style="
                                            margin-right: 0.5rem;
                                            color: var(--primary-color);
                                        "
                                    ></i>
                                    Integration Status
                                </span>
                                <span
                                    id="integrationStatus"
                                    style="
                                        font-size: 0.75rem;
                                        color: var(--success-color);
                                        font-weight: 500;
                                    "
                                    >âœ… Web Interface</span
                                >
                            </div>
                            <div
                                style="
                                    background: var(--surface-elevated);
                                    border-radius: 8px;
                                    padding: 0.75rem;
                                    font-size: 0.75rem;
                                    color: var(--text-muted);
                                    line-height: 1.4;
                                    border: 1px solid var(--border);
                                "
                            >
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        margin-bottom: 0.4rem;
                                    "
                                >
                                    <div
                                        style="
                                            width: 8px;
                                            height: 8px;
                                            border-radius: 50%;
                                            background: var(--success-color);
                                            margin-right: 0.5rem;
                                            box-shadow: 0 0 6px
                                                rgba(16, 185, 129, 0.4);
                                        "
                                    ></div>
                                    <span style="font-weight: 500"
                                        >Direct Web Chat: Active</span
                                    >
                                </div>
                                <div
                                    id="zohoStatus"
                                    style="
                                        display: flex;
                                        align-items: center;
                                        margin-bottom: 0.4rem;
                                    "
                                >
                                    <div
                                        style="
                                            width: 8px;
                                            height: 8px;
                                            border-radius: 50%;
                                            background: var(--warning-color);
                                            margin-right: 0.5rem;
                                        "
                                    ></div>
                                    <span
                                        >Zoho SalesIQ:
                                        <span
                                            style="
                                                color: var(--warning-color);
                                                font-weight: 500;
                                            "
                                            >Configure Widget</span
                                        ></span
                                    >
                                </div>
                                <div style="display: flex; align-items: center">
                                    <div
                                        style="
                                            width: 8px;
                                            height: 8px;
                                            border-radius: 50%;
                                            background: var(--success-color);
                                            margin-right: 0.5rem;
                                            box-shadow: 0 0 6px
                                                rgba(16, 185, 129, 0.4);
                                        "
                                    ></div>
                                    <span style="font-weight: 500"
                                        >API Endpoints: Ready</span
                                    >
                                </div>
                            </div>
                            <div
                                style="margin-top: 0.75rem; text-align: center"
                            >
                                <button
                                    id="zohoSetupBtn"
                                    class="action-btn info"
                                    onclick="showZohoSetupInstructions()"
                                    style="
                                        font-size: 0.75rem;
                                        padding: 0.5rem 0.75rem;
                                    "
                                >
                                    <i class="fas fa-external-link-alt"></i>
                                    <span>Setup Zoho SalesIQ</span>
                                </button>
                            </div>
                        </div>

                        <!-- Memory Conservation Indicator -->
                        <div class="memory-indicator">
                            <div
                                style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                "
                            >
                                <span
                                    style="
                                        font-size: 0.875rem;
                                        font-weight: 500;
                                    "
                                    >Memory Usage</span
                                >
                                <span
                                    id="memoryCount"
                                    style="
                                        font-size: 0.75rem;
                                        color: var(--text-muted);
                                    "
                                    >0/50</span
                                >
                            </div>
                            <div class="memory-bar">
                                <div
                                    class="memory-fill"
                                    id="memoryFill"
                                    style="width: 0%"
                                ></div>
                            </div>
                            <div class="memory-text">
                                Keeping last 50 messages for optimal performance
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Chat Area -->
                <div class="chat-container">
                    <div class="chat-header">
                        <h2>ðŸ’¬ Chat with AI</h2>
                        <p>Ask me anything! I'm here to help.</p>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <div class="welcome-message">
                            <i class="fas fa-comments"></i>
                            <h3>Welcome to Your Personal AI Assistant!</h3>
                            <p>
                                Start a conversation by typing a message below.
                            </p>
                        </div>
                    </div>

                    <div class="chat-input-container">
                        <div class="chat-input-wrapper">
                            <textarea
                                id="messageInput"
                                class="chat-input"
                                placeholder="Type your message... (supports LaTeX: \\(x^2\\) for inline, \\[x^2\\] for display)"
                                rows="1"
                                maxlength="8192"
                            ></textarea>
                            <div
                                id="inputInfo"
                                style="
                                    position: absolute;
                                    bottom: -20px;
                                    right: 8px;
                                    font-size: 11px;
                                    color: var(--text-secondary);
                                    opacity: 0.7;
                                    pointer-events: none;
                                "
                            >
                                0 words, 0 chars
                            </div>
                            <button
                                id="sendButton"
                                class="send-button"
                                onclick="sendMessage()"
                            >
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Zoho SalesIQ Chat Widget Integration -->
        <script>
            window.$zoho = window.$zoho || {};
            $zoho.salesiq = $zoho.salesiq || {
                ready: function () {
                    console.log("ðŸ”— Zoho SalesIQ widget loaded successfully");
                    // Update integration status
                    setTimeout(checkZohoIntegration, 1000);
                },
            };
        </script>
        <script
            id="zsiqscript"
            src="https://salesiq.zohopublic.com/widget?wc=siq6cc792edbb3d3978c24391c98f41f9fbe11a88aae55bbe42061308737dc62af5"
            defer
            onload="console.log('Zoho script loaded')"
            onerror="console.warn('Failed to load Zoho widget')"
        ></script>

        <!-- Fallback Zoho Widget Loader -->
        <script>
            // Fallback widget loader with retry mechanism
            function loadZohoWidgetFallback() {
                if (
                    typeof window.$zoho === "undefined" ||
                    !window.$zoho.salesiq
                ) {
                    console.log("ðŸ”„ Loading Zoho widget fallback...");

                    // Create fallback script element
                    const fallbackScript = document.createElement("script");
                    fallbackScript.type = "text/javascript";
                    fallbackScript.async = true;
                    fallbackScript.src =
                        "https://salesiq.zohopublic.com/widget?wc=siq6cc792edbb3d3978c24391c98f41f9fbe11a88aae55bbe42061308737dc62af5";

                    fallbackScript.onload = function () {
                        console.log("âœ… Zoho widget fallback loaded");
                        setTimeout(checkZohoIntegration, 2000);
                    };

                    fallbackScript.onerror = function () {
                        console.warn("âŒ Zoho widget fallback failed");
                    };

                    document.head.appendChild(fallbackScript);

                    // Create widget container if it doesn't exist
                    if (!document.getElementById("zsiqwidget")) {
                        const widgetDiv = document.createElement("div");
                        widgetDiv.id = "zsiqwidget";
                        document.body.appendChild(widgetDiv);
                    }
                }
            }

            // Try fallback after 5 seconds if main script fails
            setTimeout(function () {
                if (
                    typeof window.$zoho === "undefined" ||
                    !window.$zoho.salesiq
                ) {
                    loadZohoWidgetFallback();
                }
            }, 5000);
        </script>

        <!-- Enhanced Zoho SalesIQ Integration with Status Monitoring -->
        <script>
            // Zoho SalesIQ Integration Monitoring
            function checkZohoIntegration() {
                // Check if Zoho SalesIQ widget is loaded
                const zohoWidget = document.getElementById("zsiqwidget");
                const zohoScript = document.getElementById("zsiqscript");
                const zohoStatus = document.getElementById("zohoStatus");
                const integrationStatus =
                    document.getElementById("integrationStatus");

                let zohoLoaded = false;

                // Method 1: Check for Zoho script element
                if (zohoScript) {
                    zohoLoaded = true;
                }

                // Method 2: Check for $zoho global object
                if (
                    typeof window.$zoho !== "undefined" &&
                    window.$zoho.salesiq
                ) {
                    zohoLoaded = true;
                }

                // Method 3: Check for widget element
                if (zohoWidget && zohoWidget.innerHTML.trim() !== "") {
                    zohoLoaded = true;
                }
                // Update status in sidebar
                if (zohoStatus) {
                    if (zohoLoaded) {
                        zohoStatus.innerHTML = `
                        <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--success-color); margin-right: 0.5rem; box-shadow: 0 0 6px rgba(16, 185, 129, 0.4);"></div>
                        <span>Zoho SalesIQ: <span style="color: var(--success-color); font-weight: 500;">âœ… Active</span></span>
                    `;

                        if (integrationStatus) {
                            integrationStatus.innerHTML =
                                "âœ… Web Interface + ðŸ”— Zoho SalesIQ";
                        }

                        console.log(
                            "ðŸ”— Zoho SalesIQ widget detected and active",
                        );
                    } else {
                        zohoStatus.innerHTML = `
                        <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--warning-color); margin-right: 0.5rem;"></div>
                        <span>Zoho SalesIQ: <span style="color: var(--warning-color); font-weight: 500;">Configure Widget</span></span>
                    `;

                        if (integrationStatus) {
                            integrationStatus.innerHTML = "âœ… Web Interface";
                        }
                    }
                }

                return zohoLoaded;
            }

            // Instructions overlay for Zoho setup (global function)
            window.showZohoSetupInstructions = function () {
                const instructions = `
ðŸ”— Zoho SalesIQ Setup Instructions
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ðŸ“‹ Quick Setup Steps:

1ï¸âƒ£ Create FREE Zoho SalesIQ Account:
   â€¢ Go to: https://salesiq.zoho.com
   â€¢ Sign up with your email
   â€¢ Choose "Free" plan (supports up to 100 conversations/month)

2ï¸âƒ£ Create Custom Bot:
   â€¢ In SalesIQ dashboard, go to "Bots" section
   â€¢ Click "Create Bot" â†’ "Custom Bot"
   â€¢ Name: "Personal AI Assistant"

3ï¸âƒ£ Get Widget Code:
   â€¢ Go to "Settings" â†’ "Widget Installation"
   â€¢ Copy the widget code (looks like the commented code above)
   â€¢ Replace the commented section in this HTML file

4ï¸âƒ£ Deploy Widget:
   â€¢ Uncomment and replace the widget code
   â€¢ Add your actual widget code from Zoho
   â€¢ Refresh this page to see integration status update

ðŸ“± Multi-Platform Benefits:
   â€¢ Web chat widget on any website
   â€¢ Mobile app integration
   â€¢ Social media channel support
   â€¢ Unified conversation management

ðŸ”§ Technical Details:
   â€¢ Direct widget integration
   â€¢ No backend configuration required
   â€¢ Real-time chat through SalesIQ
   â€¢ Session management: Automatic

Need help? Check the DAY2_ZOHO_SETUP.md guide!
            `.trim();

                alert(instructions);
            };
            // Initialize Zoho integration monitoring
            function initializeZohoIntegration() {
                // Initial check
                checkZohoIntegration();

                // Monitor for Zoho widget loading
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === "childList") {
                            // Check if Zoho elements were added
                            const addedNodes = Array.from(mutation.addedNodes);
                            const hasZohoElements = addedNodes.some(
                                (node) =>
                                    node.id === "zsiqwidget" ||
                                    node.id === "zsiqscript" ||
                                    (node.textContent &&
                                        node.textContent.includes("salesiq")),
                            );

                            if (hasZohoElements) {
                                setTimeout(checkZohoIntegration, 1000);
                            }
                        }
                    });
                });

                // Start observing the document for changes
                observer.observe(document.body, {
                    childList: true,
                    subtree: true,
                });

                // Check periodically for Zoho widget
                setInterval(checkZohoIntegration, 10000); // Every 10 seconds
            }
        </script>

        <script>
            // API Configuration
            const API_BASE = window.location.origin; // Uses same domain as the page

            // Application State
            let sessionId =
                localStorage.getItem("chatSessionId") ||
                "web_" +
                    Date.now() +
                    "_" +
                    Math.random().toString(36).substr(2, 9);
            let sessionMessageCount = 0;
            let isWaitingForResponse = false;
            let lastResponseTime = 0;
            let chatHistory =
                JSON.parse(localStorage.getItem("chatHistory_" + sessionId)) ||
                [];
            let sessionStartTime =
                localStorage.getItem("sessionStartTime_" + sessionId) ||
                Date.now();

            // Conversation Management State
            let conversations =
                JSON.parse(localStorage.getItem("conversations")) || {};
            let currentConversationId = sessionId;

            // Dual Mode System - Direct LLM vs Zoho SalesIQ
            let currentMode = localStorage.getItem("chatMode") || "direct"; // "direct" or "zoho"
            let zohoWidget = null;

            // Save session ID to localStorage
            localStorage.setItem("chatSessionId", sessionId);
            localStorage.setItem(
                "sessionStartTime_" + sessionId,
                sessionStartTime,
            );

            // Auto-resize textarea
            messageInput.addEventListener("input", function () {
                this.style.height = "auto";
                this.style.height = Math.min(this.scrollHeight, 120) + "px";
            });

            function setupEventListeners() {
                // Send message on Enter (but allow Shift+Enter for new lines)
                messageInput.addEventListener("keydown", function (e) {
                    if (e.key === "Enter" && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });

                // Prevent empty form submission
                messageInput.addEventListener("keyup", function () {
                    const hasText = this.value.trim().length > 0;
                    sendButton.disabled = !hasText || isWaitingForResponse;
                });
            }

            async function checkApiHealth() {
                try {
                    const response = await fetch(`${API_BASE}/health`);
                    const data = await response.json();

                    if (data.status === "healthy") {
                        updateStatus("online", "AI Online");
                        updateModelInfo(data.model);
                    } else {
                        updateStatus("offline", "AI Offline");
                    }
                } catch (error) {
                    console.error("Health check failed:", error);
                    updateStatus("offline", "Connection Error");
                }
            }

            function updateStatus(status, text) {
                statusDot.className = `status-dot ${status}`;
                statusText.textContent = text;
            }
            function updateModelInfo(model) {
                const modelElement = document.getElementById("aiModel");
                if (modelElement && model) {
                    modelElement.textContent = model;
                }
            }

            // Conversation Management Functions
            function initializeConversations() {
                // Ensure current conversation exists in conversations list
                if (!conversations[currentConversationId]) {
                    const firstMessage =
                        chatHistory.length > 0
                            ? chatHistory[0].content
                            : "New Conversation";
                    conversations[currentConversationId] = {
                        id: currentConversationId,
                        title: generateConversationTitle(firstMessage),
                        createdAt: sessionStartTime,
                        lastActive: Date.now(),
                        messageCount: chatHistory.length,
                    };
                    saveConversations();
                }

                loadConversationList();
            }

            function generateConversationTitle(firstMessage) {
                if (!firstMessage || firstMessage.length === 0) {
                    return "New Conversation";
                }

                // Take first 30 characters and clean it up
                let title = firstMessage.substring(0, 30).trim();
                if (firstMessage.length > 30) {
                    title += "...";
                }

                // Remove line breaks and extra spaces
                title = title.replace(/\s+/g, " ");

                return title || "New Conversation";
            }

            function saveConversations() {
                localStorage.setItem(
                    "conversations",
                    JSON.stringify(conversations),
                );
            }
            function loadConversationList() {
                const conversationList =
                    document.getElementById("conversationList");
                if (!conversationList) return;

                // Sort conversations by last active time (newest first)
                const sortedConversations = Object.values(conversations).sort(
                    (a, b) => b.lastActive - a.lastActive,
                );

                conversationList.innerHTML = "";

                if (sortedConversations.length === 0) {
                    conversationList.innerHTML = `
                                <div class="empty-conversations">
                                    <i class="fas fa-comments"></i>
                                    <div>No conversations yet</div>
                                    <div style="font-size: 0.75rem; margin-top: 0.25rem; opacity: 0.7;">Start chatting to create your first conversation!</div>
                                </div>
                            `;
                    return;
                }

                sortedConversations.forEach((conversation, index) => {
                    const conversationItem =
                        createConversationItem(conversation);
                    // Add staggered animation delay
                    conversationItem.style.animationDelay = `${index * 0.1}s`;
                    conversationList.appendChild(conversationItem);
                });
            }

            function createConversationItem(conversation) {
                const item = document.createElement("div");
                item.className = `conversation-item ${conversation.id === currentConversationId ? "active" : ""}`;
                item.onclick = () => switchToConversation(conversation.id);

                const timeAgo = getTimeAgo(conversation.lastActive);
                const messageCount = conversation.messageCount || 0;

                // Create a visual indicator for conversation activity
                const activityLevel =
                    messageCount > 10
                        ? "high"
                        : messageCount > 5
                          ? "medium"
                          : "low";
                const activityIcon =
                    messageCount > 10
                        ? "fas fa-fire"
                        : messageCount > 5
                          ? "fas fa-bolt"
                          : "fas fa-comment";

                item.innerHTML = `
                            <div class="conversation-content">
                                <div class="conversation-title">${conversation.title}</div>
                                <div class="conversation-meta">
                                    <span><i class="${activityIcon}"></i> ${messageCount}</span>
                                    <span><i class="fas fa-clock"></i> ${timeAgo}</span>
                                </div>
                            </div>
                            <div class="conversation-actions">
                                <button class="conversation-action-btn" onclick="event.stopPropagation(); renameConversation('${conversation.id}')" title="Rename conversation">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="conversation-action-btn" onclick="event.stopPropagation(); deleteConversation('${conversation.id}')" title="Delete conversation">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        `;

                return item;
            }

            function getTimeAgo(timestamp) {
                const now = Date.now();
                const diff = now - parseInt(timestamp);

                const minutes = Math.floor(diff / (1000 * 60));
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));

                if (minutes < 1) return "Just now";
                if (minutes < 60) return `${minutes}m ago`;
                if (hours < 24) return `${hours}h ago`;
                if (days === 1) return "Yesterday";
                if (days < 7) return `${days}d ago`;

                return new Date(parseInt(timestamp)).toLocaleDateString();
            }

            function createNewConversation() {
                // Save current conversation state
                updateCurrentConversation();

                // Generate new conversation ID
                const newConversationId =
                    "web_" +
                    Date.now() +
                    "_" +
                    Math.random().toString(36).substr(2, 9);

                // Create new conversation
                conversations[newConversationId] = {
                    id: newConversationId,
                    title: "New Conversation",
                    createdAt: Date.now(),
                    lastActive: Date.now(),
                    messageCount: 0,
                };

                saveConversations();
                switchToConversation(newConversationId);
            }
            function switchToConversation(conversationId) {
                if (conversationId === currentConversationId) return;

                // Force save current conversation state before switching
                if (currentConversationId && chatHistory.length > 0) {
                    saveChatHistory();
                    updateCurrentConversation();
                }

                // Switch to new conversation
                currentConversationId = conversationId;
                sessionId = conversationId;

                // Update localStorage
                localStorage.setItem("chatSessionId", sessionId);

                // Load conversation data
                chatHistory =
                    JSON.parse(
                        localStorage.getItem("chatHistory_" + sessionId),
                    ) || [];
                sessionStartTime =
                    localStorage.getItem("sessionStartTime_" + sessionId) ||
                    conversations[conversationId].createdAt;

                // Reset session message count based on loaded history
                sessionMessageCount = chatHistory.filter(
                    (entry) => entry.role === "user",
                ).length;

                // Clear chat display first
                chatMessages.innerHTML = "";

                // Load chat history or show welcome message
                if (chatHistory.length === 0) {
                    chatMessages.innerHTML = `
                                <div class="welcome-message">
                                    <div class="welcome-content">
                                        <div class="ai-avatar">ðŸ¤–</div>
                                        <h3>Welcome to Your Personal AI Assistant!</h3>
                                        <p>I'm ready to help you with a fresh conversation. What would you like to discuss?</p>
                                        <div class="welcome-features">
                                            <span class="feature-tag">ðŸ”’ Private</span>
                                            <span class="feature-tag">ðŸ’¾ Memory</span>
                                            <span class="feature-tag">âš¡ Fast</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                } else {
                    loadChatHistory();
                }

                // Update UI
                loadConversationList();
                updateSessionStats();

                // Update conversation last active time
                conversations[conversationId].lastActive = Date.now();
                saveConversations();
            }
            function updateCurrentConversation() {
                if (!conversations[currentConversationId]) return;

                // Update conversation metadata
                conversations[currentConversationId].messageCount =
                    chatHistory.length;
                conversations[currentConversationId].lastActive = Date.now();

                // Update title if it's still default and we have messages
                if (
                    conversations[currentConversationId].title ===
                        "New Conversation" &&
                    chatHistory.length > 0
                ) {
                    const firstUserMessage = chatHistory.find(
                        (msg) => msg.role === "user",
                    );
                    if (firstUserMessage) {
                        conversations[currentConversationId].title =
                            generateConversationTitle(firstUserMessage.content);
                    }
                }

                // Force save conversations
                saveConversations();

                // Update the conversation list display
                loadConversationList();
            }

            function renameConversation(conversationId) {
                const conversation = conversations[conversationId];
                if (!conversation) return;

                const newTitle = prompt(
                    "Enter new conversation name:",
                    conversation.title,
                );
                if (newTitle && newTitle.trim()) {
                    conversation.title = newTitle.trim();
                    saveConversations();
                    loadConversationList();
                }
            }

            function deleteConversation(conversationId) {
                if (Object.keys(conversations).length <= 1) {
                    alert("Cannot delete the last conversation.");
                    return;
                }

                const conversation = conversations[conversationId];
                if (!conversation) return;

                if (
                    confirm(
                        `Delete conversation "${conversation.title}"? This cannot be undone.`,
                    )
                ) {
                    // Remove from localStorage
                    localStorage.removeItem("chatHistory_" + conversationId);
                    localStorage.removeItem(
                        "sessionStartTime_" + conversationId,
                    );

                    // Remove from conversations
                    delete conversations[conversationId];
                    saveConversations();

                    // If deleting current conversation, switch to another
                    if (conversationId === currentConversationId) {
                        const remainingConversations =
                            Object.keys(conversations);
                        if (remainingConversations.length > 0) {
                            switchToConversation(remainingConversations[0]);
                        }
                    } else {
                        loadConversationList();
                    }
                }
            }

            // Chat History Management
            function saveChatHistory() {
                localStorage.setItem(
                    "chatHistory_" + sessionId,
                    JSON.stringify(chatHistory),
                );
                console.log(
                    `ðŸ’¾ Saved chat history for ${sessionId}: ${chatHistory.length} messages`,
                );
            }

            function addToChatHistory(role, content) {
                const entry = {
                    role: role,
                    content: content,
                    timestamp: Date.now(),
                    formatted_time: new Date().toLocaleTimeString(),
                };

                chatHistory.push(entry);

                // Keep only last 50 messages for memory conservation
                if (chatHistory.length > 50) {
                    chatHistory = chatHistory.slice(-50);
                }

                // Force save immediately
                saveChatHistory();

                // Update conversation metadata and force save
                updateCurrentConversation();

                // Debug logging
                console.log(
                    `ðŸ’¾ Saved ${role} message to conversation ${currentConversationId}:`,
                    content.substring(0, 50) + "...",
                );
            }
            function loadChatHistory() {
                if (chatHistory.length === 0) return;

                console.log(
                    `ðŸ“– Loading chat history for ${sessionId}: ${chatHistory.length} messages`,
                );

                // Restore messages from history
                chatHistory.forEach((entry, index) => {
                    console.log(
                        `  ${index + 1}. ${entry.role}: ${entry.content.substring(0, 50)}...`,
                    );
                    addMessage(entry.role, entry.content, false, false); // Don't save to history again
                });

                sessionMessageCount = chatHistory.filter(
                    (entry) => entry.role === "user",
                ).length;
                updateSessionStats();

                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function clearChatHistory() {
                if (
                    confirm(
                        "Are you sure you want to clear the chat history? This cannot be undone.",
                    )
                ) {
                    chatHistory = [];
                    localStorage.removeItem("chatHistory_" + sessionId);

                    // Clear the chat display
                    chatMessages.innerHTML = `
                                <div class="welcome-message">
                                    <div class="welcome-content">
                                        <div class="ai-avatar">ðŸ¤–</div>
                                        <h3>Welcome to Your Personal AI Assistant!</h3>
                                        <p>I'm powered by Phi-3 Mini and running privately on your infrastructure. How can I help you today?</p>
                                        <div class="welcome-features">
                                            <span class="feature-tag">ðŸ”’ Private</span>
                                            <span class="feature-tag">ðŸ’¾ Memory</span>
                                            <span class="feature-tag">âš¡ Fast</span>
                                        </div>
                                    </div>
                                </div>
                            `;

                    sessionMessageCount = 0;
                    updateSessionStats();
                }
            }

            function newChatSession() {
                if (
                    confirm(
                        "Start a new chat session? Current conversation will be saved but a new session will begin.",
                    )
                ) {
                    createNewConversation();
                }
            }

            async function sendMessage() {
                const message = messageInput.value.trim();
                if (!message || isWaitingForResponse) return;

                // Check for special commands
                if (handleSpecialCommands(message)) {
                    return; // Command was handled, don't process as regular message
                }

                // Clear input and update UI
                messageInput.value = "";
                messageInput.style.height = "auto";
                isWaitingForResponse = true;
                sendButton.disabled = true;

                // Remove welcome message if present
                const welcomeMessage =
                    chatMessages.querySelector(".welcome-message");
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }

                // Add user message
                addMessage("user", message);
                sessionMessageCount++;
                updateSessionStats();

                // Route message based on current mode
                console.log("ðŸ“¤ Routing message via mode:", currentMode);
                if (currentMode === "zoho") {
                    console.log("ðŸ”— Sending to Zoho SalesIQ...");
                    await sendToZohoSalesIQ(message);
                } else {
                    console.log("ðŸ¤– Sending to Direct LLM...");
                    await sendToDirectLLM(message);
                }
            }

            function handleSpecialCommands(message) {
                const messageText = message.toLowerCase().trim();
                const firstWord = messageText.split(" ")[0];

                console.log(
                    "ðŸ” Checking command:",
                    firstWord,
                    "in message:",
                    message,
                );

                // Check if the first word is a command
                if (firstWord === "#zoho" || firstWord === "/zoho") {
                    console.log("âœ… Detected Zoho command");
                    // Clear input and handle command
                    messageInput.value = "";
                    messageInput.style.height = "auto";
                    switchToZohoMode();

                    // If there's additional text after the command, process it in Zoho mode
                    const remainingText = message
                        .trim()
                        .substring(firstWord.length)
                        .trim();
                    if (remainingText.length > 0) {
                        console.log(
                            "ðŸ“ Additional text found, will send:",
                            remainingText,
                        );
                        setTimeout(() => {
                            messageInput.value = remainingText;
                            sendMessage();
                        }, 500); // Small delay to let mode switch complete
                    }
                    return true;
                } else if (
                    firstWord === "#direct" ||
                    firstWord === "/direct" ||
                    firstWord === "#llm" ||
                    firstWord === "/llm"
                ) {
                    console.log("âœ… Detected Direct mode command");
                    messageInput.value = "";
                    messageInput.style.height = "auto";
                    switchToDirectMode();

                    // If there's additional text after the command, process it in direct mode
                    const remainingText = message
                        .trim()
                        .substring(firstWord.length)
                        .trim();
                    if (remainingText.length > 0) {
                        console.log(
                            "ðŸ“ Additional text found, will send:",
                            remainingText,
                        );
                        setTimeout(() => {
                            messageInput.value = remainingText;
                            sendMessage();
                        }, 500);
                    }
                    return true;
                } else if (firstWord === "#help" || firstWord === "/help") {
                    console.log("âœ… Detected Help command");
                    messageInput.value = "";
                    messageInput.style.height = "auto";
                    showCommandHelp();
                    return true;
                } else if (firstWord === "#status" || firstWord === "/status") {
                    console.log("âœ… Detected Status command");
                    messageInput.value = "";
                    messageInput.style.height = "auto";
                    showSystemStatus();
                    return true;
                }

                console.log("âŒ No command detected");
                return false; // Not a special command
            }

            function switchToZohoMode() {
                console.log("ðŸ”— Switching to Zoho SalesIQ mode...");

                currentMode = "zoho";
                localStorage.setItem("chatMode", "zoho");

                addMessage(
                    "system",
                    `ðŸ”— **Switched to Zoho SalesIQ Mode**

            Your messages will now be sent directly through the Zoho SalesIQ widget.

            â€¢ Professional chat interface
            â€¢ Zoho widget features enabled
            â€¢ Direct integration with SalesIQ

            Type \`#direct\` to switch back to direct LLM mode.`,
                    false,
                    false,
                );

                updateModeIndicator();
                console.log("âœ… Mode switched to Zoho SalesIQ");

                // Try to open Zoho widget if available
                if (
                    typeof window.$zoho !== "undefined" &&
                    window.$zoho.salesiq
                ) {
                    try {
                        window.$zoho.salesiq.chat.start();
                        console.log("âœ… Zoho widget activated");
                    } catch (e) {
                        console.log(
                            "âš ï¸ Zoho widget not fully loaded yet:",
                            e.message,
                        );
                    }
                } else {
                    console.log("â„¹ï¸ Zoho widget not detected");
                }
            }

            function switchToDirectMode() {
                console.log("ðŸ¤– Switching to Direct LLM mode...");
                currentMode = "direct";
                localStorage.setItem("chatMode", "direct");

                addMessage(
                    "system",
                    `ðŸ¤– **Switched to Direct LLM Mode**

            Your messages will now be sent directly to the Phi-3 Mini model.

            â€¢ Direct AI processing
            â€¢ Faster responses
            â€¢ Local model control
            â€¢ Full conversation context

            Type \`#zoho\` to switch to Zoho SalesIQ mode.`,
                    false,
                    false,
                );

                updateModeIndicator();
                console.log("âœ… Mode switched to Direct LLM");
            }

            function showCommandHelp() {
                addMessage(
                    "system",
                    `ðŸ’¡ **Available Commands**

            **Mode Switching:**
            â€¢ \`#zoho\` or \`/zoho\` - Switch to Zoho SalesIQ mode
            â€¢ \`#direct\` or \`/direct\` - Switch to Direct LLM mode
            â€¢ \`#llm\` or \`/llm\` - Switch to Direct LLM mode

            **Smart Commands:**
            â€¢ \`#zoho Hello\` - Switch to Zoho mode and send "Hello"
            â€¢ \`#direct What is AI?\` - Switch to Direct mode and ask question

            **Information:**
            â€¢ \`#help\` or \`/help\` - Show this help
            â€¢ \`#status\` or \`/status\` - Show system status

            **LaTeX Support:**
            â€¢ Inline: \\\\(x^2\\\\) renders as inline math
            â€¢ Display: \\\\[\\\\frac{1}{2}\\\\] renders as display math
            â€¢ Example: \\\\(d = \\\\frac{1}{p}\\\\) for parallax distance formula

            **Input Limits:**
            â€¢ Maximum: 1024 words per message
            â€¢ Character limit: 8192 characters
            â€¢ Real-time word/character counting enabled

            **Current Mode:** ${currentMode === "zoho" ? "ðŸ”— Zoho SalesIQ" : "ðŸ¤– Direct LLM"}`,
                    false,
                    false,
                );
            }

            function setupEventListeners() {
                // Send message on Enter (but allow Shift+Enter for new lines)
                messageInput.addEventListener("keydown", function (e) {
                    if (e.key === "Enter" && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });

                // Prevent empty form submission
                messageInput.addEventListener("keyup", function () {
                    const hasText = this.value.trim().length > 0;
                    sendButton.disabled = !hasText || isWaitingForResponse;
                });
            }

            async function checkApiHealth() {
                try {
                    const response = await fetch(`${API_BASE}/health`);
                    const data = await response.json();

                    if (data.status === "healthy") {
                        updateStatus("online", "AI Online");
                        updateModelInfo(data.model);
                    } else {
                        updateStatus("offline", "AI Offline");
                    }
                } catch (error) {
                    console.error("Health check failed:", error);
                    updateStatus("offline", "Connection Error");
                }
            }

            function updateStatus(status, text) {
                statusDot.className = `status-dot ${status}`;
                statusText.textContent = text;
            }
            function updateModelInfo(model) {
                const modelElement = document.getElementById("aiModel");
                if (modelElement && model) {
                    modelElement.textContent = model;
                }
            }

            // Conversation Management Functions
            function initializeConversations() {
                // Ensure current conversation exists in conversations list
                if (!conversations[currentConversationId]) {
                    const firstMessage =
                        chatHistory.length > 0
                            ? chatHistory[0].content
                            : "New Conversation";
                    conversations[currentConversationId] = {
                        id: currentConversationId,
                        title: generateConversationTitle(firstMessage),
                        createdAt: sessionStartTime,
                        lastActive: Date.now(),
                        messageCount: chatHistory.length,
                    };
                    saveConversations();
                }

                loadConversationList();
            }

            function generateConversationTitle(firstMessage) {
                if (!firstMessage || firstMessage.length === 0) {
                    return "New Conversation";
                }

                // Take first 30 characters and clean it up
                let title = firstMessage.substring(0, 30).trim();
                if (firstMessage.length > 30) {
                    title += "...";
                }

                // Remove line breaks and extra spaces
                title = title.replace(/\s+/g, " ");

                return title || "New Conversation";
            }

            function saveConversations() {
                localStorage.setItem(
                    "conversations",
                    JSON.stringify(conversations),
                );
            }
            function loadConversationList() {
                const conversationList =
                    document.getElementById("conversationList");
                if (!conversationList) return;

                // Sort conversations by last active time (newest first)
                const sortedConversations = Object.values(conversations).sort(
                    (a, b) => b.lastActive - a.lastActive,
                );

                conversationList.innerHTML = "";

                if (sortedConversations.length === 0) {
                    conversationList.innerHTML = `
                                            <div class="empty-conversations">
                                                <i class="fas fa-comments"></i>
                                                <div>No conversations yet</div>
                                                <div style="font-size: 0.75rem; margin-top: 0.25rem; opacity: 0.7;">Start chatting to create your first conversation!</div>
                                            </div>
                                        `;
                    return;
                }

                sortedConversations.forEach((conversation, index) => {
                    const conversationItem =
                        createConversationItem(conversation);
                    // Add staggered animation delay
                    conversationItem.style.animationDelay = `${index * 0.1}s`;
                    conversationList.appendChild(conversationItem);
                });
            }

            function createConversationItem(conversation) {
                const item = document.createElement("div");
                item.className = `conversation-item ${conversation.id === currentConversationId ? "active" : ""}`;
                item.onclick = () => switchToConversation(conversation.id);

                const timeAgo = getTimeAgo(conversation.lastActive);
                const messageCount = conversation.messageCount || 0;

                // Create a visual indicator for conversation activity
                const activityLevel =
                    messageCount > 10
                        ? "high"
                        : messageCount > 5
                          ? "medium"
                          : "low";
                const activityIcon =
                    messageCount > 10
                        ? "fas fa-fire"
                        : messageCount > 5
                          ? "fas fa-bolt"
                          : "fas fa-comment";

                item.innerHTML = `
                                        <div class="conversation-content">
                                            <div class="conversation-title">${conversation.title}</div>
                                            <div class="conversation-meta">
                                                <span><i class="${activityIcon}"></i> ${messageCount}</span>
                                                <span><i class="fas fa-clock"></i> ${timeAgo}</span>
                                            </div>
                                        </div>
                                        <div class="conversation-actions">
                                            <button class="conversation-action-btn" onclick="event.stopPropagation(); renameConversation('${conversation.id}')" title="Rename conversation">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="conversation-action-btn" onclick="event.stopPropagation(); deleteConversation('${conversation.id}')" title="Delete conversation">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    `;

                return item;
            }

            function getTimeAgo(timestamp) {
                const now = Date.now();
                const diff = now - parseInt(timestamp);

                const minutes = Math.floor(diff / (1000 * 60));
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));

                if (minutes < 1) return "Just now";
                if (minutes < 60) return `${minutes}m ago`;
                if (hours < 24) return `${hours}h ago`;
                if (days === 1) return "Yesterday";
                if (days < 7) return `${days}d ago`;

                return new Date(parseInt(timestamp)).toLocaleDateString();
            }

            function createNewConversation() {
                // Save current conversation state
                updateCurrentConversation();

                // Generate new conversation ID
                const newConversationId =
                    "web_" +
                    Date.now() +
                    "_" +
                    Math.random().toString(36).substr(2, 9);

                // Create new conversation
                conversations[newConversationId] = {
                    id: newConversationId,
                    title: "New Conversation",
                    createdAt: Date.now(),
                    lastActive: Date.now(),
                    messageCount: 0,
                };

                saveConversations();
                switchToConversation(newConversationId);
            }
            function switchToConversation(conversationId) {
                if (conversationId === currentConversationId) return;

                // Force save current conversation state before switching
                if (currentConversationId && chatHistory.length > 0) {
                    saveChatHistory();
                    updateCurrentConversation();
                }

                // Switch to new conversation
                currentConversationId = conversationId;
                sessionId = conversationId;

                // Update localStorage
                localStorage.setItem("chatSessionId", sessionId);

                // Load conversation data
                chatHistory =
                    JSON.parse(
                        localStorage.getItem("chatHistory_" + sessionId),
                    ) || [];
                sessionStartTime =
                    localStorage.getItem("sessionStartTime_" + sessionId) ||
                    conversations[conversationId].createdAt;

                // Reset session message count based on loaded history
                sessionMessageCount = chatHistory.filter(
                    (entry) => entry.role === "user",
                ).length;

                // Clear chat display first
                chatMessages.innerHTML = "";

                // Load chat history or show welcome message
                if (chatHistory.length === 0) {
                    chatMessages.innerHTML = `
                                            <div class="welcome-message">
                                                <div class="welcome-content">
                                                    <div class="ai-avatar">ðŸ¤–</div>
                                                    <h3>Welcome to Your Personal AI Assistant!</h3>
                                                    <p>I'm ready to help you with a fresh conversation. What would you like to discuss?</p>
                                                    <div class="welcome-features">
                                                        <span class="feature-tag">ðŸ”’ Private</span>
                                                        <span class="feature-tag">ðŸ’¾ Memory</span>
                                                        <span class="feature-tag">âš¡ Fast</span>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                } else {
                    loadChatHistory();
                }

                // Update UI
                loadConversationList();
                updateSessionStats();

                // Update conversation last active time
                conversations[conversationId].lastActive = Date.now();
                saveConversations();
            }
            function updateCurrentConversation() {
                if (!conversations[currentConversationId]) return;

                // Update conversation metadata
                conversations[currentConversationId].messageCount =
                    chatHistory.length;
                conversations[currentConversationId].lastActive = Date.now();

                // Update title if it's still default and we have messages
                if (
                    conversations[currentConversationId].title ===
                        "New Conversation" &&
                    chatHistory.length > 0
                ) {
                    const firstUserMessage = chatHistory.find(
                        (msg) => msg.role === "user",
                    );
                    if (firstUserMessage) {
                        conversations[currentConversationId].title =
                            generateConversationTitle(firstUserMessage.content);
                    }
                }

                // Force save conversations
                saveConversations();

                // Update the conversation list display
                loadConversationList();
            }

            function renameConversation(conversationId) {
                const conversation = conversations[conversationId];
                if (!conversation) return;

                const newTitle = prompt(
                    "Enter new conversation name:",
                    conversation.title,
                );
                if (newTitle && newTitle.trim()) {
                    conversation.title = newTitle.trim();
                    saveConversations();
                    loadConversationList();
                }
            }

            function deleteConversation(conversationId) {
                if (Object.keys(conversations).length <= 1) {
                    alert("Cannot delete the last conversation.");
                    return;
                }

                const conversation = conversations[conversationId];
                if (!conversation) return;

                if (
                    confirm(
                        `Delete conversation "${conversation.title}"? This cannot be undone.`,
                    )
                ) {
                    // Remove from localStorage
                    localStorage.removeItem("chatHistory_" + conversationId);
                    localStorage.removeItem(
                        "sessionStartTime_" + conversationId,
                    );

                    // Remove from conversations
                    delete conversations[conversationId];
                    saveConversations();

                    // If deleting current conversation, switch to another
                    if (conversationId === currentConversationId) {
                        const remainingConversations =
                            Object.keys(conversations);
                        if (remainingConversations.length > 0) {
                            switchToConversation(remainingConversations[0]);
                        }
                    } else {
                        loadConversationList();
                    }
                }
            }

            // Chat History Management
            function saveChatHistory() {
                localStorage.setItem(
                    "chatHistory_" + sessionId,
                    JSON.stringify(chatHistory),
                );
                console.log(
                    `ðŸ’¾ Saved chat history for ${sessionId}: ${chatHistory.length} messages`,
                );
            }

            function addToChatHistory(role, content) {
                const entry = {
                    role: role,
                    content: content,
                    timestamp: Date.now(),
                    formatted_time: new Date().toLocaleTimeString(),
                };

                chatHistory.push(entry);

                // Keep only last 50 messages for memory conservation
                if (chatHistory.length > 50) {
                    chatHistory = chatHistory.slice(-50);
                }

                // Force save immediately
                saveChatHistory();

                // Update conversation metadata and force save
                updateCurrentConversation();

                // Debug logging
                console.log(
                    `ðŸ’¾ Saved ${role} message to conversation ${currentConversationId}:`,
                    content.substring(0, 50) + "...",
                );
            }
            function loadChatHistory() {
                if (chatHistory.length === 0) return;

                console.log(
                    `ðŸ“– Loading chat history for ${sessionId}: ${chatHistory.length} messages`,
                );

                // Restore messages from history
                chatHistory.forEach((entry, index) => {
                    console.log(
                        `  ${index + 1}. ${entry.role}: ${entry.content.substring(0, 50)}...`,
                    );
                    addMessage(entry.role, entry.content, false, false); // Don't save to history again
                });

                sessionMessageCount = chatHistory.filter(
                    (entry) => entry.role === "user",
                ).length;
                updateSessionStats();

                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function clearChatHistory() {
                if (
                    confirm(
                        "Are you sure you want to clear the chat history? This cannot be undone.",
                    )
                ) {
                    chatHistory = [];
                    localStorage.removeItem("chatHistory_" + sessionId);

                    // Clear the chat display
                    chatMessages.innerHTML = `
                                            <div class="welcome-message">
                                                <div class="welcome-content">
                                                    <div class="ai-avatar">ðŸ¤–</div>
                                                    <h3>Welcome to Your Personal AI Assistant!</h3>
                                                    <p>I'm powered by Phi-3 Mini and running privately on your infrastructure. How can I help you today?</p>
                                                    <div class="welcome-features">
                                                        <span class="feature-tag">ðŸ”’ Private</span>
                                                        <span class="feature-tag">ðŸ’¾ Memory</span>
                                                        <span class="feature-tag">âš¡ Fast</span>
                                                    </div>
                                                </div>
                                            </div>
                                        `;

                    sessionMessageCount = 0;
                    updateSessionStats();
                }
            }

            function newChatSession() {
                if (
                    confirm(
                        "Start a new chat session? Current conversation will be saved but a new session will begin.",
                    )
                ) {
                    createNewConversation();
                }
            }

            async function sendMessage() {
                const message = messageInput.value.trim();
                if (!message || isWaitingForResponse) return;

                // Check for special commands
                if (handleSpecialCommands(message)) {
                    return; // Command was handled, don't process as regular message
                }

                // Clear input and update UI
                messageInput.value = "";
                messageInput.style.height = "auto";
                isWaitingForResponse = true;
                sendButton.disabled = true;

                // Remove welcome message if present
                const welcomeMessage =
                    chatMessages.querySelector(".welcome-message");
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }

                // Add user message
                addMessage("user", message);
                sessionMessageCount++;
                updateSessionStats();

                // Route message based on current mode
                console.log("ðŸ“¤ Routing message via mode:", currentMode);
                if (currentMode === "zoho") {
                    console.log("ðŸ”— Sending to Zoho SalesIQ...");
                    await sendToZohoSalesIQ(message);
                } else {
                    console.log("ðŸ¤– Sending to Direct LLM...");
                    await sendToDirectLLM(message);
                }
            }

            function handleSpecialCommands(message) {
                const messageText = message.toLowerCase().trim();
                const firstWord = messageText.split(" ")[0];

                console.log(
                    "ðŸ” Checking command:",
                    firstWord,
                    "in message:",
                    message,
                );

                // Check if the first word is a command
                if (firstWord === "#zoho" || firstWord === "/zoho") {
                    console.log("âœ… Detected Zoho command");
                    // Clear input and handle command
                    messageInput.value = "";
                    messageInput.style.height = "auto";
                    switchToZohoMode();

                    // If there's additional text after the command, process it in Zoho mode
                    const remainingText = message
                        .trim()
                        .substring(firstWord.length)
                        .trim();
                    if (remainingText.length > 0) {
                        console.log(
                            "ðŸ“ Additional text found, will send:",
                            remainingText,
                        );
                        setTimeout(() => {
                            messageInput.value = remainingText;
                            sendMessage();
                        }, 500); // Small delay to let mode switch complete
                    }
                    return true;
                } else if (
                    firstWord === "#direct" ||
                    firstWord === "/direct" ||
                    firstWord === "#llm" ||
                    firstWord === "/llm"
                ) {
                    console.log("âœ… Detected Direct mode command");
                    messageInput.value = "";
                    messageInput.style.height = "auto";
                    switchToDirectMode();

                    // If there's additional text after the command, process it in direct mode
                    const remainingText = message
                        .trim()
                        .substring(firstWord.length)
                        .trim();
                    if (remainingText.length > 0) {
                        console.log(
                            "ðŸ“ Additional text found, will send:",
                            remainingText,
                        );
                        setTimeout(() => {
                            messageInput.value = remainingText;
                            sendMessage();
                        }, 500);
                    }
                    return true;
                } else if (firstWord === "#help" || firstWord === "/help") {
                    console.log("âœ… Detected Help command");
                    messageInput.value = "";
                    messageInput.style.height = "auto";
                    showCommandHelp();
                    return true;
                } else if (firstWord === "#status" || firstWord === "/status") {
                    console.log("âœ… Detected Status command");
                    messageInput.value = "";
                    messageInput.style.height = "auto";
                    showSystemStatus();
                    return true;
                }

                console.log("âŒ No command detected");
                return false; // Not a special command
            }

            function switchToZohoMode() {
                console.log("ðŸ”— Switching to Zoho SalesIQ mode...");

                currentMode = "zoho";
                localStorage.setItem("chatMode", "zoho");

                addMessage(
                    "system",
                    `ðŸ”— **Switched to Zoho SalesIQ Mode**

                        Your messages will now be sent directly through the Zoho SalesIQ widget.

                        â€¢ Professional chat interface
                        â€¢ Zoho widget features enabled
                        â€¢ Direct integration with SalesIQ

                        Type \`#direct\` to switch back to direct LLM mode.`,
                    false,
                    false,
                );

                updateModeIndicator();
                console.log("âœ… Mode switched to Zoho SalesIQ");

                // Try to open Zoho widget if available
                if (
                    typeof window.$zoho !== "undefined" &&
                    window.$zoho.salesiq
                ) {
                    try {
                        window.$zoho.salesiq.chat.start();
                        console.log("âœ… Zoho widget activated");
                    } catch (e) {
                        console.log(
                            "âš ï¸ Zoho widget not fully loaded yet:",
                            e.message,
                        );
                    }
                } else {
                    console.log("â„¹ï¸ Zoho widget not detected");
                }
            }

            function switchToDirectMode() {
                console.log("ðŸ¤– Switching to Direct LLM mode...");
                currentMode = "direct";
                localStorage.setItem("chatMode", "direct");

                addMessage(
                    "system",
                    `ðŸ¤– **Switched to Direct LLM Mode**

                        Your messages will now be sent directly to the Phi-3 Mini model.

                        â€¢ Direct AI processing
                        â€¢ Faster responses
                        â€¢ Local model control
                        â€¢ Full conversation context

                        Type \`#zoho\` to switch to Zoho SalesIQ mode.`,
                    false,
                    false,
                );

                updateModeIndicator();
                console.log("âœ… Mode switched to Direct LLM");
            }

            function showCommandHelp() {
                addMessage(
                    "system",
                    `ðŸ’¡ **Available Commands**

                                            **Mode Switching:**
                                            â€¢ \`#zoho\` or \`/zoho\` - Switch to Zoho SalesIQ mode
                                            â€¢ \`#direct\` or \`/direct\` - Switch to Direct LLM mode
                                            â€¢ \`#llm\` or \`/llm\` - Switch to Direct LLM mode

                                            **Smart Commands:**
                                            â€¢ \`#zoho Hello\` - Switch to Zoho mode and send "Hello"
                                            â€¢ \`#direct What is AI?\` - Switch to Direct mode and ask question

                                            **Information:**
                                            â€¢ \`#help\` or \`/help\` - Show this help
                                            â€¢ \`#status\` or \`/status\` - Show system status

                                            **LaTeX Support:**
                                            â€¢ Inline: \\(x^2\\) or $x^2$
                                            â€¢ Display: \\[\\frac{1}{2}\\] or $$\\frac{1}{2}$$
                                            â€¢ Example: \\(d = \\frac{1}{p}\\) renders as mathematical formula

                                            **Input Limits:**
                                            â€¢ Maximum: 1024 words per message
                                            â€¢ Character limit: 8192 characters

                                            **Current Mode:** ${currentMode === "zoho" ? "ðŸ”— Zoho SalesIQ" : "ðŸ¤– Direct LLM"}`,
                    false,
                    false,
                );
            }

            function showSystemStatus() {
                const zohoStatus =
                    typeof window.$zoho !== "undefined" && window.$zoho.salesiq
                        ? "âœ… Active"
                        : "âŒ Not Loaded";
                const apiStatus = statusText.textContent;

                addMessage(
                    "system",
                    `ðŸ“Š **System Status**

                        **Current Mode:** ${currentMode === "zoho" ? "ðŸ”— Zoho SalesIQ" : "ðŸ¤– Direct LLM"}
                        **API Status:** ${apiStatus}
                        **Zoho Widget:** ${zohoStatus}
                        **Session:** ${sessionId.substring(0, 12)}...
                        **Messages:** ${chatHistory.length}/50
                        **Uptime:** ${Math.floor((Date.now() - sessionStartTime) / 60000)} minutes`,
                    false,
                    false,
                );
            }

            function updateModeIndicator() {
                // Update status indicator to show current mode
                const modeText =
                    currentMode === "zoho" ? "Zoho Mode" : "Direct Mode";
                const modeIcon = currentMode === "zoho" ? "ðŸ”—" : "ðŸ¤–";

                // Add mode indicator to header if not exists
                let modeIndicator = document.getElementById("modeIndicator");
                if (!modeIndicator) {
                    modeIndicator = document.createElement("div");
                    modeIndicator.id = "modeIndicator";
                    modeIndicator.style.cssText = `
                                                display: flex;
                                                align-items: center;
                                                gap: 0.5rem;
                                                padding: 0.5rem 1rem;
                                                background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
                                                border-radius: 20px;
                                                font-size: 0.875rem;
                                                font-weight: 500;
                                                color: var(--primary-color);
                                                border: 1px solid rgba(99, 102, 241, 0.2);
                                            `;

                    const headerContent =
                        document.querySelector(".header-content");
                    if (headerContent) {
                        headerContent.appendChild(modeIndicator);
                    }
                }

                modeIndicator.innerHTML = `${modeIcon} ${modeText}`;
            }

            async function sendToDirectLLM(message) {
                // Show typing indicator
                showTypingIndicator();

                try {
                    const startTime = Date.now();
                    // Try streaming first for better UX
                    await sendMessageWithStreaming(message, startTime);
                } catch (error) {
                    console.error("Chat error:", error);
                    hideTypingIndicator();
                    addMessage(
                        "assistant",
                        `Connection error: ${error.message}. Please check if the API server is running.`,
                        true,
                    );
                } finally {
                    isWaitingForResponse = false;
                    sendButton.disabled = false;
                    messageInput.focus();
                }
            }

            async function sendToZohoSalesIQ(message) {
                // Show different typing indicator for Zoho mode
                showTypingIndicator("Sending via Zoho SalesIQ...");

                try {
                    // If Zoho widget is available, try to use it
                    if (
                        typeof window.$zoho !== "undefined" &&
                        window.$zoho.salesiq &&
                        window.$zoho.salesiq.chat
                    ) {
                        // Send message through Zoho widget
                        window.$zoho.salesiq.chat.send(message);

                        hideTypingIndicator();
                        addMessage(
                            "assistant",
                            "ðŸ”— **Message sent via Zoho SalesIQ widget**\n\nYour message has been sent to the Zoho SalesIQ system. Responses will appear in the Zoho chat widget.",
                        );
                    } else {
                        // Fallback: Send through direct LLM
                        hideTypingIndicator();
                        addMessage(
                            "assistant",
                            "âš ï¸ **Zoho widget not available**\n\nFalling back to direct LLM mode for this message.",
                            true,
                        );

                        // Send through direct LLM as fallback
                        await sendToDirectLLM(message);
                    }

                    sessionMessageCount++;
                    updateStats();
                } catch (error) {
                    hideTypingIndicator();
                    console.error("Zoho SalesIQ error:", error);
                    addMessage(
                        "assistant",
                        `âŒ Zoho SalesIQ error: ${error.message}`,
                        true,
                    );
                } finally {
                    isWaitingForResponse = false;
                    sendButton.disabled = false;
                    messageInput.focus();
                }
            }

            async function sendMessageWithStreaming(message, startTime) {
                let hasHiddenTypingIndicator = false; // Track when to hide typing indicator

                try {
                    const response = await fetch(`${API_BASE}/chat/stream`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "X-Session-ID": sessionId,
                        },
                        body: JSON.stringify({ message: message }),
                    });

                    if (!response.ok) {
                        throw new Error(
                            `HTTP ${response.status}: ${response.statusText}`,
                        );
                    }

                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let currentMessageDiv = null;
                    let currentContentDiv = null;
                    let buffer = "";

                    while (true) {
                        const { done, value } = await reader.read();

                        if (done) break;

                        buffer += decoder.decode(value, { stream: true });
                        const lines = buffer.split("\n");
                        buffer = lines.pop() || ""; // Keep incomplete line in buffer
                        for (const line of lines) {
                            if (line.startsWith("data: ")) {
                                try {
                                    const data = JSON.parse(line.slice(6));

                                    if (data.status === "processing") {
                                        // Update typing indicator
                                        const typingText =
                                            document.querySelector(
                                                ".typing-text",
                                            );
                                        if (typingText) {
                                            typingText.textContent =
                                                data.message;
                                        }
                                    } else if (data.status === "streaming") {
                                        // Hide typing indicator when first streaming content arrives
                                        if (!hasHiddenTypingIndicator) {
                                            hideTypingIndicator();
                                            hasHiddenTypingIndicator = true;
                                        }

                                        // Create or update streaming message
                                        if (!currentMessageDiv) {
                                            currentMessageDiv =
                                                document.createElement("div");
                                            currentMessageDiv.className =
                                                "message assistant";

                                            currentContentDiv =
                                                document.createElement("div");
                                            currentContentDiv.className =
                                                "message-content";

                                            const metaDiv =
                                                document.createElement("div");
                                            metaDiv.className = "message-meta";
                                            metaDiv.textContent =
                                                new Date().toLocaleTimeString();

                                            currentMessageDiv.appendChild(
                                                currentContentDiv,
                                            );
                                            currentMessageDiv.appendChild(
                                                metaDiv,
                                            );
                                            chatMessages.appendChild(
                                                currentMessageDiv,
                                            );
                                        }

                                        // Update content with streaming text
                                        if (currentContentDiv) {
                                            const formattedText = formatMessage(
                                                data.full_response || "",
                                            );
                                            currentContentDiv.innerHTML =
                                                formattedText +
                                                '<span class="typing-cursor">|</span>';

                                            // Trigger MathJax for streaming content
                                            if (
                                                window.MathJax &&
                                                window.MathJax.typesetPromise
                                            ) {
                                                window.MathJax.typesetPromise([
                                                    currentContentDiv,
                                                ]).catch((err) =>
                                                    console.log(
                                                        "MathJax typeset failed: " +
                                                            err.message,
                                                    ),
                                                );
                                            }

                                            chatMessages.scrollTop =
                                                chatMessages.scrollHeight;
                                        }
                                    } else if (data.status === "complete") {
                                        // Finalize the message
                                        if (currentContentDiv) {
                                            const formattedText = formatMessage(
                                                data.full_response,
                                            );
                                            currentContentDiv.innerHTML =
                                                formattedText;

                                            // Remove typing cursor
                                            const cursor =
                                                currentContentDiv.querySelector(
                                                    ".typing-cursor",
                                                );
                                            if (cursor) cursor.remove();

                                            // Final MathJax rendering
                                            if (
                                                window.MathJax &&
                                                window.MathJax.typesetPromise
                                            ) {
                                                window.MathJax.typesetPromise([
                                                    currentContentDiv,
                                                ]).catch((err) =>
                                                    console.log(
                                                        "MathJax typeset failed: " +
                                                            err.message,
                                                    ),
                                                );
                                            }
                                        }

                                        // Update stats
                                        const endTime = Date.now();
                                        lastResponseTime = endTime - startTime;
                                        sessionMessageCount++;
                                        updateStats();

                                        // Save to history manually (since streaming doesn't go through addMessage)
                                        addToChatHistory(
                                            "assistant",
                                            data.full_response,
                                        );

                                        // Update conversation metadata immediately
                                        updateCurrentConversation();

                                        break;
                                    } else if (data.status === "error") {
                                        hideTypingIndicator();
                                        addMessage(
                                            "assistant",
                                            `Error: ${data.error}`,
                                            true,
                                        );
                                        break;
                                    }
                                } catch (e) {
                                    console.warn(
                                        "Failed to parse SSE data:",
                                        line,
                                        e,
                                    );
                                }
                            }
                        }
                    }
                } catch (error) {
                    // Ensure typing indicator is hidden before fallback
                    if (!hasHiddenTypingIndicator) {
                        hideTypingIndicator();
                    }

                    // Fallback to regular endpoint
                    console.warn(
                        "Streaming failed, falling back to regular endpoint:",
                        error,
                    );
                    await sendMessageFallback(message, startTime);
                }
            }

            async function sendMessageFallback(message, startTime) {
                try {
                    const response = await fetch(`${API_BASE}/chat`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "X-Session-ID": sessionId,
                        },
                        body: JSON.stringify({ message: message }),
                    });

                    const endTime = Date.now();
                    lastResponseTime = endTime - startTime;

                    hideTypingIndicator();

                    if (!response.ok) {
                        throw new Error(
                            `HTTP ${response.status}: ${response.statusText}`,
                        );
                    }

                    const data = await response.json();

                    if (data.success) {
                        addMessage("assistant", data.response);
                        sessionMessageCount++;
                        updateStats();

                        // Trigger MathJax for fallback responses
                        setTimeout(() => {
                            if (
                                window.MathJax &&
                                window.MathJax.typesetPromise
                            ) {
                                window.MathJax.typesetPromise().catch((err) =>
                                    console.log(
                                        "MathJax typeset failed: " +
                                            err.message,
                                    ),
                                );
                            }
                        }, 100);
                    } else {
                        addMessage(
                            "assistant",
                            `Error: ${data.error || "Unknown error occurred"}`,
                            true,
                        );
                    }
                } catch (error) {
                    hideTypingIndicator();
                    throw error; // Re-throw to be handled by the main function
                }
            }

            function addMessage(
                sender,
                text,
                isError = false,
                saveToHistory = true,
            ) {
                const messageDiv = document.createElement("div");
                messageDiv.className = `message ${sender}`;

                const contentDiv = document.createElement("div");
                contentDiv.className = "message-content";
                if (isError) {
                    contentDiv.style.background = "#fef2f2";
                    contentDiv.style.borderColor = "#fecaca";
                    contentDiv.style.color = "#dc2626";
                } else if (sender === "system") {
                    contentDiv.style.background =
                        "linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%)";
                    contentDiv.style.borderColor = "rgba(99, 102, 241, 0.3)";
                    contentDiv.style.color = "var(--text-primary)";
                }

                // Format text (basic markdown-like formatting)
                const formattedText = formatMessage(text);
                contentDiv.innerHTML = formattedText;

                const metaDiv = document.createElement("div");
                metaDiv.className = "message-meta";
                metaDiv.textContent = new Date().toLocaleTimeString();

                messageDiv.appendChild(contentDiv);
                messageDiv.appendChild(metaDiv);
                chatMessages.appendChild(messageDiv);

                // Save to chat history (unless explicitly disabled or system message)
                if (saveToHistory && !isError && sender !== "system") {
                    addToChatHistory(sender, text);
                }

                // Trigger MathJax rendering for LaTeX formulas
                setTimeout(() => {
                    if (window.MathJax && window.MathJax.typesetPromise) {
                        window.MathJax.typesetPromise([messageDiv]).catch(
                            (err) =>
                                console.log(
                                    "MathJax typeset failed: " + err.message,
                                ),
                        );
                    }
                }, 100);

                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function formatMessage(text) {
                // Basic formatting: convert **bold** and *italic*
                let formatted = text
                    .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
                    .replace(/\*(.*?)\*/g, "<em>$1</em>")
                    .replace(/\n/g, "<br>");

                // Trigger MathJax rendering after DOM update
                setTimeout(() => {
                    if (window.MathJax && window.MathJax.typesetPromise) {
                        window.MathJax.typesetPromise().catch((err) =>
                            console.log(
                                "MathJax typeset failed: " + err.message,
                            ),
                        );
                    }
                }, 100);

                return formatted;
            }

            function updateInputInfo() {
                const inputInfo = document.getElementById("inputInfo");
                if (!inputInfo) return;

                const text = messageInput.value;
                const charCount = text.length;
                const wordCount =
                    text.trim() === "" ? 0 : text.trim().split(/\s+/).length;
                const maxChars = 8192;
                const maxWords = 1024;

                // Update display
                inputInfo.textContent = `${wordCount} words, ${charCount} chars`;

                // Color coding based on limits
                if (wordCount > maxWords || charCount > maxChars) {
                    inputInfo.style.color = "var(--error-color)";
                    inputInfo.style.fontWeight = "bold";
                } else if (
                    wordCount > maxWords * 0.8 ||
                    charCount > maxChars * 0.8
                ) {
                    inputInfo.style.color = "var(--warning-color)";
                    inputInfo.style.fontWeight = "normal";
                } else {
                    inputInfo.style.color = "var(--text-secondary)";
                    inputInfo.style.fontWeight = "normal";
                }
            }

            function validateInput(text) {
                const charCount = text.length;
                const wordCount =
                    text.trim() === "" ? 0 : text.trim().split(/\s+/).length;
                const maxChars = 8192;
                const maxWords = 1024;

                if (wordCount > maxWords) {
                    showInputError(
                        `Message too long: ${wordCount} words (max: ${maxWords})`,
                    );
                    return false;
                }

                if (charCount > maxChars) {
                    showInputError(
                        `Message too long: ${charCount} characters (max: ${maxChars})`,
                    );
                    return false;
                }

                return true;
            }

            function showInputError(message) {
                // Create temporary error message
                const errorDiv = document.createElement("div");
                errorDiv.style.cssText = `
                                            position: fixed;
                                            top: 20px;
                                            right: 20px;
                                            background: var(--error-color);
                                            color: white;
                                            padding: 12px 16px;
                                            border-radius: 8px;
                                            font-size: 14px;
                                            z-index: 10000;
                                            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                                        `;
                errorDiv.textContent = message;
                document.body.appendChild(errorDiv);

                // Remove after 3 seconds
                setTimeout(() => {
                    if (errorDiv.parentNode) {
                        errorDiv.parentNode.removeChild(errorDiv);
                    }
                }, 3000);
            }

            function showTypingIndicator(customText = null) {
                const typingDiv = document.createElement("div");
                typingDiv.className = "typing-indicator";
                typingDiv.id = "typingIndicator";

                // Create dots
                for (let i = 0; i < 3; i++) {
                    const dot = document.createElement("div");
                    dot.className = "typing-dot";
                    typingDiv.appendChild(dot);
                }

                // Add helpful text
                const textDiv = document.createElement("div");
                textDiv.className = "typing-text";
                textDiv.textContent =
                    customText ||
                    (currentMode === "zoho"
                        ? "Zoho SalesIQ processing..."
                        : "AI is thinking...");
                textDiv.style.fontSize = "0.75rem";
                textDiv.style.color = "var(--text-secondary)";
                textDiv.style.marginLeft = "8px";
                typingDiv.appendChild(textDiv);

                chatMessages.appendChild(typingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Progressive messages for longer waits (only for direct mode)
                if (currentMode === "direct" && !customText) {
                    setTimeout(() => {
                        const currentTyping =
                            document.getElementById("typingIndicator");
                        if (currentTyping) {
                            const textElement =
                                currentTyping.querySelector(".typing-text");
                            if (textElement) {
                                textElement.textContent =
                                    "Processing complex request...";
                            }
                        }
                    }, 10000); // After 10 seconds

                    setTimeout(() => {
                        const currentTyping =
                            document.getElementById("typingIndicator");
                        if (currentTyping) {
                            const textElement =
                                currentTyping.querySelector(".typing-text");
                            if (textElement) {
                                textElement.textContent =
                                    "AI model is working hard (up to 10 minutes for complex queries)...";
                            }
                        }
                    }, 30000); // After 30 seconds

                    setTimeout(() => {
                        const currentTyping =
                            document.getElementById("typingIndicator");
                        if (currentTyping) {
                            const textElement =
                                currentTyping.querySelector(".typing-text");
                            if (textElement) {
                                textElement.textContent =
                                    "Almost ready, complex analysis takes time...";
                            }
                        }
                    }, 120000); // After 2 minutes

                    setTimeout(() => {
                        const currentTyping =
                            document.getElementById("typingIndicator");
                        if (currentTyping) {
                            const textElement =
                                currentTyping.querySelector(".typing-text");
                            if (textElement) {
                                textElement.textContent =
                                    "Still processing - this is a really complex question!";
                            }
                        }
                    }, 300000); // After 5 minutes
                }
            }

            function hideTypingIndicator() {
                const typingIndicator =
                    document.getElementById("typingIndicator");
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            function clearChat() {
                if (
                    confirm(
                        "Are you sure you want to clear the chat? This cannot be undone.",
                    )
                ) {
                    chatMessages.innerHTML = `
                                            <div class="welcome-message">
                                                <i class="fas fa-comments"></i>
                                                <h3>Chat cleared! Ready for a new conversation.</h3>
                                                <p>Start a conversation by typing a message below.</p>
                                            </div>
                                        `;

                    // Reset session
                    sessionId =
                        "web_" +
                        Date.now() +
                        "_" +
                        Math.random().toString(36).substr(2, 9);
                    sessionMessageCount = 0;
                    updateSessionStats();
                    messageInput.focus();
                }
            }

            function updateSessionStats() {
                const sessionElement =
                    document.getElementById("sessionMessages");
                if (sessionElement) {
                    sessionElement.textContent = sessionMessageCount;
                }

                // Update memory indicator
                updateMemoryIndicator();
            }

            function updateMemoryIndicator() {
                const memoryCount = document.getElementById("memoryCount");
                const memoryFill = document.getElementById("memoryFill");

                if (memoryCount && memoryFill) {
                    const currentCount = chatHistory.length;
                    const maxCount = 50;
                    const percentage = (currentCount / maxCount) * 100;

                    memoryCount.textContent = `${currentCount}/${maxCount}`;
                    memoryFill.style.width = `${percentage}%`;

                    // Change color based on usage
                    if (percentage > 90) {
                        memoryFill.style.background = "var(--error-color)";
                    } else if (percentage > 70) {
                        memoryFill.style.background = "var(--warning-color)";
                    } else {
                        memoryFill.style.background = "var(--gradient-primary)";
                    }
                }
            }

            function showSessionInfo() {
                const sessionDuration = Date.now() - parseInt(sessionStartTime);
                const hours = Math.floor(sessionDuration / (1000 * 60 * 60));
                const minutes = Math.floor(
                    (sessionDuration % (1000 * 60 * 60)) / (1000 * 60),
                );

                const info = `
                        Session Information:
                        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

                        ðŸ“‹ Session ID: ${sessionId}
                        â° Duration: ${hours}h ${minutes}m
                        ðŸ’¬ Messages: ${chatHistory.length}/50
                        ðŸ“Š User Messages: ${chatHistory.filter((m) => m.role === "user").length}
                        ðŸ¤– AI Responses: ${chatHistory.filter((m) => m.role === "assistant").length}
                        ðŸ•’ Started: ${new Date(parseInt(sessionStartTime)).toLocaleString()}
                        âš¡ Last Response: ${lastResponseTime}ms

                        ðŸ§  Memory Management:
                        â€¢ Automatically keeps last 50 messages
                        â€¢ Older messages are archived locally
                        â€¢ Session persists across browser sessions
                                    `.trim();

                alert(info);
            }

            async function updateStats() {
                try {
                    const response = await fetch(`${API_BASE}/stats`);
                    const data = await response.json();

                    const totalElement =
                        document.getElementById("totalMessages");
                    const responseTimeElement =
                        document.getElementById("responseTime");

                    if (totalElement) {
                        totalElement.textContent = data.total_requests || 0;
                    }

                    if (responseTimeElement && lastResponseTime) {
                        responseTimeElement.textContent = `${lastResponseTime}ms`;
                    }
                } catch (error) {
                    console.error("Failed to update stats:", error);
                }
            } // Export chat history
            function exportChatHistory() {
                if (chatHistory.length === 0) {
                    alert("No chat history to export.");
                    return;
                }

                const exportData = {
                    sessionId: sessionId,
                    sessionStartTime: new Date(
                        parseInt(sessionStartTime),
                    ).toISOString(),
                    exportTime: new Date().toISOString(),
                    messageCount: chatHistory.length,
                    messages: chatHistory.map((entry) => ({
                        role: entry.role,
                        content: entry.content,
                        timestamp: new Date(entry.timestamp).toISOString(),
                    })),
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                    type: "application/json",
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = `chat-history-${new Date().toISOString().split("T")[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // Zoho Bookings Integration Functions
            function toggleBookingWidget() {
                console.log("ðŸ“… Toggling Zoho Bookings widget...");
                const widget = document.getElementById("bookingWidget");

                if (widget.style.display === "none") {
                    // Show widget
                    widget.style.display = "block";

                    // Create booking iframe if not exists
                    if (!widget.innerHTML) {
                        // TODO: Replace 'javalorant' with your actual Zoho Bookings portal name
                        // Get this from: Zoho Bookings â†’ Workspaces â†’ Share â†’ Embed
                        widget.innerHTML = `
                            <iframe
                                src="https://bookings.zoho.com/portal/javalorant"
                                height="500"
                                style="border: none; border-radius: 8px;">
                            </iframe>
                            <div style="text-align: center; margin-top: 0.5rem;">
                                <small style="color: #666;">Powered by Zoho Bookings</small>
                                <br><small style="color: #999;">Update portal URL in code with your booking page</small>
                            </div>
                        `;
                    }

                    addMessage(
                        "system",
                        "ðŸ“… **Zoho Bookings Widget Activated**\n\n" +
                            "**Setup Required:**\n" +
                            "1. Create account at https://bookings.zoho.com\n" +
                            "2. Set up your booking service\n" +
                            "3. Get your portal URL from Workspaces â†’ Share â†’ Embed\n" +
                            "4. Replace 'javalorant' in code with your portal name\n\n" +
                            "**Features:**\n" +
                            "â€¢ Choose available time slots\n" +
                            "â€¢ Automatic calendar sync\n" +
                            "â€¢ Email confirmations\n" +
                            "â€¢ No back-and-forth emails",
                    );
                } else {
                    // Hide widget
                    widget.style.display = "none";
                    addMessage("system", "ðŸ“… Booking widget hidden.");
                }
            }

            function showBookingInfo() {
                addMessage(
                    "system",
                    "ðŸ“… **Zoho Bookings Setup Guide**\n\n" +
                        "**Free Account Setup:**\n" +
                        "1. Visit https://bookings.zoho.com\n" +
                        "2. Sign up with your Zoho account\n" +
                        "3. Create your first service (consultation, demo, etc.)\n" +
                        "4. Set your availability and time zone\n" +
                        "5. Customize your booking page\n\n" +
                        "**Get Widget URL:**\n" +
                        "â€¢ Go to Workspaces â†’ Share â†’ Embed\n" +
                        "â€¢ Copy your portal URL\n" +
                        "â€¢ Replace 'javalorant' in the code\n\n" +
                        "**Free Features:** 1 event type, calendar sync, notifications",
                );
            }

            // Zoho Assist Integration Functions
            function toggleAssistWidget() {
                console.log("ðŸ› ï¸ Toggling Zoho Assist widget...");
                const widget = document.getElementById("assistWidget");

                if (widget.style.display === "none") {
                    // Show widget
                    widget.style.display = "block";

                    // Create assist iframe if not exists
                    if (!widget.innerHTML) {
                        widget.innerHTML = `
                            <iframe
                                src="https://assist.zoho.com/customer/join"
                                height="400"
                                style="border: none; border-radius: 8px;">
                            </iframe>
                            <div style="text-align: center; margin-top: 0.5rem;">
                                <small style="color: #666;">Powered by Zoho Assist</small>
                            </div>
                        `;
                    }

                    addMessage(
                        "system",
                        "ðŸ› ï¸ **Zoho Assist Widget Activated**\n\n" +
                            "**Setup Required:**\n" +
                            "1. Create account at https://assist.zoho.com\n" +
                            "2. Set up your organization\n" +
                            "3. Get your custom assist URL\n" +
                            "4. Update widget URL in code\n\n" +
                            "**Features:**\n" +
                            "â€¢ Screen sharing\n" +
                            "â€¢ Remote control\n" +
                            "â€¢ File transfer\n" +
                            "â€¢ Voice/video chat",
                    );
                } else {
                    // Hide widget
                    widget.style.display = "none";
                    addMessage("system", "ðŸ› ï¸ Remote support widget hidden.");
                }
            }

            function showAssistInfo() {
                addMessage(
                    "system",
                    "ðŸ› ï¸ **Zoho Assist Setup Guide**\n\n" +
                        "**Free Account Setup:**\n" +
                        "1. Visit https://assist.zoho.com\n" +
                        "2. Sign up for free account\n" +
                        "3. Set up your organization name\n" +
                        "4. Configure security settings\n" +
                        "5. Get your custom portal URL\n\n" +
                        "**Widget Integration:**\n" +
                        "â€¢ Copy your assist portal URL\n" +
                        "â€¢ Update iframe src in the code\n" +
                        "â€¢ Test remote session functionality\n\n" +
                        "**Free Features:** Unlimited sessions, screen sharing, secure connections",
                );
            }

            // Initialize application
            function initializeApp() {
                console.log("ðŸš€ Initializing Personal AI Assistant...");
                console.log("Session ID:", sessionId);
                console.log("Chat History:", chatHistory.length, "messages");

                // Initialize conversation management
                initializeConversations();

                // Load existing chat history
                loadChatHistory();

                // Initial health check
                checkApiHealth();

                // Initial stats update
                updateStats();

                // Initialize Zoho SalesIQ integration monitoring
                initializeZohoIntegration();

                // Show welcome message for new Zoho services
                if (chatHistory.length === 0) {
                    addMessage(
                        "system",
                        "ðŸŽ‰ **Welcome to Enhanced Zoho Integration!**\n\n" +
                            "I've been upgraded with embedded Zoho widgets:\n\n" +
                            "ðŸ“… **Zoho Bookings** - Schedule appointments easily:\n" +
                            "â€¢ Embedded booking widget\n" +
                            "â€¢ Calendar integration\n" +
                            "â€¢ Automatic notifications\n\n" +
                            "ðŸ› ï¸ **Zoho Assist** - Get remote support:\n" +
                            "â€¢ Screen sharing widget\n" +
                            "â€¢ Remote troubleshooting\n" +
                            "â€¢ Cross-platform support\n\n" +
                            "ðŸ’¬ **Zoho SalesIQ** - Live chat integration\n\n" +
                            "All widgets are embedded directly in the sidebar! How can I help you get started?",
                    );
                }

                // Focus on input and initialize input info
                if (messageInput) {
                    messageInput.focus();
                    updateInputInfo();
                }

                console.log("âœ… App initialized successfully");
            } // Initialize when page loads
            document.addEventListener("DOMContentLoaded", initializeApp);

            // Periodic health checks
            setInterval(checkApiHealth, 30000); // Every 30 seconds

            // Auto-update stats periodically
            setInterval(updateStats, 10000); // Every 10 seconds

            // Auto-save conversations periodically (safety net)
            setInterval(function () {
                if (chatHistory.length > 0) {
                    saveChatHistory();
                    updateCurrentConversation();
                    console.log("ðŸ”„ Auto-saved conversation state");
                }
            }, 15000); // Every 15 seconds

            // Enhanced input event listener for word counting and validation
            if (messageInput) {
                messageInput.addEventListener("input", function () {
                    this.style.height = "auto";
                    this.style.height = Math.min(this.scrollHeight, 120) + "px";
                    updateInputInfo();
                });

                messageInput.addEventListener("keyup", function () {
                    const hasText = this.value.trim().length > 0;
                    sendButton.disabled = !hasText || isWaitingForResponse;
                    updateInputInfo();
                });
            }

            // Enhanced sendMessage wrapper with validation
            const originalSendMessage = sendMessage;
            window.sendMessage = async function () {
                const message = messageInput.value.trim();
                if (!message || isWaitingForResponse) return;

                // Validate input length
                if (!validateInput(message)) {
                    return; // Validation failed, don't send
                }

                // Call original sendMessage function
                return await originalSendMessage();
            };

            // Save on page unload
            window.addEventListener("beforeunload", function () {
                if (chatHistory.length > 0) {
                    saveChatHistory();
                    updateCurrentConversation();
                }
            });
        </script>
    </body>
</html>
